<h1>Aprenda a Criar um Blog Usando Parse.js: Trabalhando com Dados</h1>

<p>No último post, nós preparamos um servidor local (<a href="https://www.apachefriends.org/index.html" rel="external" target="_blank">XAMPP</a>), um servidor web (<a href="https://pages.github.com/" rel="external" target="_blank">Páginas do GitHub</a>) e um servidor de base de dados (<a href="https://parse.com/" rel="external" target="_blank">Parse.com</a>). Também preparamos o HTML de uma página de blog e embutimos o código básico do Parse.js para conecta-lo à base de dados. Nessa seção, ensinarei como criar, buscar e mostrar seu primeiro objeto.</p>

<p>Se você não se importar em usar o painel administrativo do Parse.com, você pode criar portfolios, blogs, páginas de destino (<em>landing pages</em>), etc, assim que terminar essa seção.</p>

<h2>O Conceito de uma Classe e de uma Instância</h2>

<p>Antes de nos aprofundarmos nso códigos e continuarmos criando a aplicação, vejamos o básico sobre classes e instâncias, para garantir que todos tenham uma mesma base de conhecimento. Novamente, sinta-se a vontade para pular essa parte, caso esses conhecimentos já lhe sejam familiares.</p>

<p>De acordo com a Wikipedia:</p>

<blockquote>Uma classe “é uma estrutura que abstrai um conjunto de objetos com características similares. Uma classe define o comportamento de seus objetos através de métodos e os estados possíveis destes objetos através de atributos;” and "quando um objeto é criado pelo construtor de uma classe, o objeto resultando é chamado de instância da classe."  </blockquote><p>Se essas definições são muito abstratas para você, vejamos sua aplicação no contexto de um blog. </p>

<h3>Uma Classe Blog</h3>

<p>Pense nos principais componentes dos blogs. Eles, provavelmente, tem um título, um autor, uma página de conteúdo, um horário de quando foi criado, etc. Esses atributos compartilhados servirão de modelo para todos os blogs que temos. Assim, surge a classe Blog:</p>

<figure class="post_image"><img alt="A blog class" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22047/image/01-a-blog-class.png"></figure>

<h3>Uma Instância de Blog</h3>

<p>E quando temos a classe <code class="inline">Blog</code>, cada blog que se encaixa nesse modelo, pode ser uma instância da classe <code class="inline">Blog</code>:</p>

<figure class="post_image"><img alt="A blog instance" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22047/image/02-a-blog-instance.png"></figure>

<p>Para identificar quando estivermos falando sobre a classe <code class="inline">Blog</code>, sempre usaremos a letra inicial (<em>B</em>) em maísculo. Por outro lado, quando estivermos tratando de um blog específico, usaremos a letra inicial (<em>b</em>) em minúsculo. Essa regra serve tanto para esse tutorial quanto para o código JavaScript que criaremos.</p>

<p>Você também perceberá que no Parse.com você verá, bastante, a palavra "object" (objeto). Nesse contexto, utilizaremos a regra do maísculo-minúsculo: usaremos "object" para uma isntância e "Object" para a classe. Você logo se acostumará.</p>

<h3>A Tabela Blog</h3>

<p>Uma vez que a classe define todos os atributos que uma instância possui, é fácil guardar todas as instâncias de uma mesma classe em um tabela: cada atributo seria uma coluna e cada instância seria um registro:</p>

<figure class="post_image"><img alt="A blog table" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22047/image/03-a-blog-table.png"></figure>

<p>E é exatamente dessa forma que você guardará seus dados no Parse.com</p>

<h2>Criando a Classe Blog</h2>

<p>Vamos lá... Criemos a classe no Parse.com.</p>

<h3>Passo 1: Adicionando uma Classe Blog</h3>

<p>Primeiro, vá até seu painel no Parse.com, encontre o seu projeto e clique em "Core" - "Data" (antigamente, Data Browser). E então, clique em "Add Class."</p>

<figure class="post_image"><img alt="Add a blog class on Parse" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22047/image/04-Parse-add-Blog-class.png"></figure>

<p>Como pode ver pela captura de tela, é preciso criar uma classe customizada para seus blogs. Vamos chamá-la de <code class="inline">Blog</code>. Você sempre quererá que suas classes sejam bem diretas e verbosas, explicando o que elas guardam na base de dados.</p>

<p>Como você pode ver, temos uma classe customizada, vazia, no Parse.com:</p>

<figure class="post_image"><img alt="Newly created custom class on Parse" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22047/image/05-Parse-empty-class.png"></figure>

<p>Cada classe customizada deve ter quatro atributos próprios do sistema do do Parse.com:</p>

<ul><li><code class="inline">objectId</code> - um identificado único, gerado automaticamente pelo Parse quando um objeto é criado. Dessa forma, o programa saberá a qual objeto você se refere. (Como vê, aqui, a palavra objeto está relacionado a uma instância)</li>
<li><code class="inline">createdAt</code> - a marca temporal (<em>timestamp</em>), gerada automaticamente pelo Parse quando você cria o objeto pela primeira vez.</li>
<li><code class="inline">updatedAt</code> - a marca temporal gerada e atualizada automaticamente pelo Parse, toda vez que você atualiza o objeto.</li>
<li><code class="inline">ACL</code> - uma lista de controle de acesso aos objetos, que define quem pode ler e mexer com aquele objeto. Se não estiver definido, ele usa o valor padrão de controle de acesso à classe. Discutiremos melhor sobre isso em seções futuras. Pode deixar em branco, por hora.</li>
</ul>

<h3>Passo 2: Adicionando Colunas à Classe Blog</h3>

<p>Agora, continuemos e criemos colunas para os atributos que definem um blog. Para manter as coisas o mais simples possível, criaremos apenas dois deles: <code class="inline">title</code> (título) e <code class="inline">content</code> (conteúdo).</p>

<p>Clique no botão "+ Col" para criar uma nova coluna. Atribua o tipo "String" e o nomeie como <code class="inline">title</code>.</p>

<figure class="post_image"><img alt="Add title column on Parse" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22047/image/06-Parse-add-col.png"></figure>

<p>Repita o processo e crie uma coluna <code class="inline">content</code>, também do tipo "<b>String</b>".</p>

<h3>Passo 3: Adicionando Alguns Blogs</h3>

<p>Hora de adicionar alguns blogs (nota: blogs, em inglês, também é usados para referir-se a posts)! Clique no botão "<b>+ Row</b>" e clique duas vezes nas células do título e conteúdo para adicionar algum conteúdo:</p>

<figure class="post_image"><img alt="Add blog posts on Parse" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22047/image/07-Parse-add-row.png"></figure>

<p>Perceba que você também pode colocar código HTML na coluna de conteúdo. Na verdade, todas as colunas do tipo "string" podem salvar, sem problemas, código HTML. Nesse caso, porém, a coluna do título não devee conter qualquer código HTML.</p>

<p>Como falei antes, uma vez que o Parse.com permite você manipular sua base de dados dessa forma, você pode usá-la, normalmente, como seu painel administrativo, caso não queira criar o seu próprio. E, uma vez que você aprenda como renderizar dados em seu site, você poderá criar, facilmente, seus blogs ou portfolios dinâmicos. Dando continuidade, mostrarei como fazer isso.</p>

<h2>Buscando e Retornando os Dados do Blog</h2>

<p>Volte ao seu arquivo <code class="inline">blog.js</code>. É hora de remover o código de teste e pegar os dados do blog, lá no Parse.com!</p>

<p>Primeiro, crie uma classe JavaScript, estendendo a classe Blog, usando a API do Parse.js:</p>

<pre class="brush: javascript">var Blog = Parse.Object.extend("Blog");</pre>

<p>Em se tratando da página inicial de um blog, você, provavelmente, quererá uma lista com os últimos posts. Essa lista com ojetos de um mesmo tipo, é chamado de coleção pelo Parse. Criemos a nossa primera coleção:</p>

<pre class="brush: javascript">var Blogs = Parse.Collection.extend({
    model: Blog
});</pre>

<p>Note que tanto <code class="inline">Blog</code> quanto <code class="inline">Blogs</code> são classes. Elas são os modelos abstratos para blogs e coleções de posts. Você pode ter blogs e coleções específicas e diferentes. E aquelas serão suas bases.</p>

<p>Agora, para obter uma coleção de verdade com todos os blogs que você adicionou lá no Parse.com, é preciso criar uma instância da coleção Blogs (perceba que a primera letra não deve ser maiúscula, aqui):</p>

<pre class="brush: javascript">var blogs = new Blogs();</pre>

<p>Se não especificarmos qualquer coisa e apenas pegarmos uma nova coleção com os dados, ela buscará todos os registros na tabela <code class="inline">Blog</code>, por padrão.</p>

<p>Busquemos e imprimamos os dados no console:</p>

<pre class="brush: javascript">blogs.fetch({
	success: function(blogs) {
		console.log(blogs);
	},
	error: function(blogs, error) {
		console.log(error);
	}
});</pre>

<p>Carregue o site no seu servidor local, novamente, verifique o console das suas ferramentas de desenvolvedor, e você será capaz de ver algo assim:</p>

<figure class="post_image"><img alt="Blog data in console" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22047/image/08-console-log-data.png"></figure>

<p>Agora você já tem os dados!</p>

<h2>Mostrando os Dados na Página</h2>

<p>Antes de mostrarmos os dados do blog na página, precisamos preparar um modelo HTML para isso.</p>

<h3>Passo 1: Limpando o HTML</h3>

<p>Limpe tudo que esteja dentro de <code class="inline">.blog-main</code> e substitua por um recipiente simples:</p>

<pre class="brush: html">&lt;div class="col-sm-8 blog-main"&gt;
	&lt;div class="main-container"&gt;&lt;/div&gt;
&lt;/div&gt;</pre>

<p>Agora, se você olhar o modelo original do blog, perceberá que a estrutura HTML para um único post pode ser simplificada, dessa forma:</p>

<pre class="brush: plain">&lt;div class="blog-post"&gt;
    &lt;h2 class="blog-post-title"&gt;&lt;a href="#"&gt;Um título&lt;/a&gt;&lt;/h2&gt;
	&lt;p class="blog-post-meta"&gt;Em horário por um autor&lt;/p&gt;
	&lt;div&gt;Algum conteúdo&lt;/div&gt;
&lt;/div&gt;</pre>

<p>Tudo que queremos é substituir os espaços reservados com os dados de verdade de cada post que temos no Parse.com.</p>

<h3>Passo 2: Preparando o Modelo de Blog</h3>

<p>Para fazer isso, precisamos transformar o HTML em um modelo, que receberá um objeto de dados e o transformará em uma cadeia de caracteres HTML.</p>

<p>Queremos que o modelo receba um vetor de blogs:</p>

<pre class="brush: javascript">[{
    title: 'Olá Mundo',
	content: 'O primeiro post!'
}, {
	title: 'Segundo Post',
	content: '&lt;p&gt;Você também pode inserir HTML no conteúdo.&lt;/p&gt;'
}, ...]</pre>

<div></div><p>E o renderize em HTML, dessa forma:</p>

<pre class="brush: html">&lt;div class="blog-post"&gt;
    &lt;h2 class="blog-post-title"&gt;&lt;a href="#"&gt;Olá Mundo&lt;/a&gt;&lt;/h2&gt;
	&lt;p class="blog-post-meta"&gt;Em horário por um autor&lt;/p&gt;
	&lt;div&gt;O primeiro post!&lt;/div&gt;
&lt;/div&gt;
&lt;div class="blog-post"&gt;
	&lt;h2 class="blog-post-title"&gt;&lt;a href="#"&gt;Segundo Post&lt;/a&gt;&lt;/h2&gt;
	&lt;p class="blog-post-meta"&gt;Em horário por um autor&lt;/p&gt;
	&lt;div&gt;&lt;p&gt;Você também pode inserir HTML no conteúdo.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;</pre>

<p>Mostrarei como usar o <a href="http://handlebarsjs.com/" rel="external" target="_blank">handlebars.js</a> para fazer realizar essa tarefa, nesse tutorial, mas você também pode usar o <a href="http://underscorejs.org/#template" rel="external" target="_blank">underscore.js</a>, <a href="http://mustache.github.io/" rel="external" target="_blank">mustache</a> ou outra biblioteca de modelos que preferir.</p>

<p>Para poder usar o <a href="http://handlebarsjs.com/" rel="external" target="_blank">handlebars.js</a>, primeiro, temos de adicioná-lo no arquivo <code class="inline">index.html</code> abaixo do arquivo <code class="inline">parse.js</code>:</p>

<pre class="brush: html">&lt;!-- Handlebars.js --&gt;
&lt;script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.min.js"&gt;&lt;/script&gt;</pre>

<p>Agora, pegaremos o HTML ajustado para um único post e o colocaremos em uma tag <code class="inline">&lt;script&gt;</code> especial para o handlebars, logo acima das tags <code class="inline">&lt;script&gt;</code> dos nossos arquivos JavaScript externos. Também o daremos o <code>id</code> de <code class="inline">#blogs-tpl</code>. Dessa forma, o handlebars poderá saber que ela é um modelo, além de ter uma forma de referenciá-la:</p>

<pre class="brush: html">&lt;script id="blogs-tpl" type="text/x-handlebars-template"&gt;
    &lt;div class="blog-post"&gt;
		&lt;h2 class="blog-post-title"&gt;&lt;a href="#"&gt;Um título&lt;/a&gt;&lt;/h2&gt;
		&lt;p class="blog-post-meta"&gt;Em horário por um autor&lt;/p&gt;
		&lt;div&gt;Algum conteúdo&lt;/div&gt;
	&lt;/div&gt;
&lt;/script&gt;</pre>

<p>Depois, para permitir que o handlebars saiba onde colocar os valores do título e do conteúdo, precisará substituir o "Um título" por <code class="inline">{{title}}</code> e "Algum conteúdo" por <code class="inline">{{{content}}}</code>. O Handlebars.js percebe o conteúdo entre o conjunto de chaves <code class="inline">{{}}</code> como variáveis. </p>

<pre class="brush: html">&lt;script id="blogs-tpl" type="text/x-handlebars-template"&gt;
    &lt;div class="blog-post"&gt;
		&lt;h2 class="blog-post-title"&gt;&lt;a href="#"&gt;{{title}}&lt;/a&gt;&lt;/h2&gt;
		&lt;p class="blog-post-meta"&gt;Em horário por um autor&lt;/p&gt;
		&lt;div&gt;{{{content}}}&lt;/div&gt;
	&lt;/div&gt;
&lt;/script&gt;</pre>

<p>Perceba que, para o conteúdo, usamos três pares de chaves, <code class="inline">{{{}}}</code>, ao invés de apenas dois, <code class="inline">{{}}</code>. Ao usar apenas dois pares, o handlebars.js converte todo o HTML dentro da propriedade usada, por padrão. Ao usar três pares, o handlebars.js mantém o HTMl intacto no conteúdo.</p>

<p>A alteração final que precisa fazer no <code class="inline">#blogs-tpl</code> é envolver o modelo do blog dentro do par <code class="inline">{{#each blog}} {{/each}}</code>. Assim, ele poderá receber um vetor de objetos para renderizar a todos, um por um:</p>

<pre class="brush: html">&lt;script id="blogs-tpl" type="text/x-handlebars-template"&gt;
    {{#each blog}}
	&lt;div class="blog-post"&gt;
		&lt;h2 class="blog-post-title"&gt;&lt;a href="#"&gt;{{title}}&lt;/a&gt;&lt;/h2&gt;
		&lt;p class="blog-post-meta"&gt;Em horário por um autor&lt;/p&gt;
		&lt;div&gt;{{{content}}}&lt;/div&gt;
	&lt;/div&gt;
	{{/each}}
&lt;/script&gt;</pre>

<h3>Passo 3: Renderize os Blogs</h3>

<p>Agora que temos um modelo pronto, voltemos para o arquivo <code class="inline">blog.js</code> e renderizemos esses posts na página. </p>

<p>Para tanto, precisará criar uma visão para a coleção de blogs. O conceito de visão vem do <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" rel="external" target="_blank">padrão de arquitetura MVC (model–view–controller, ou modelo-visão-controlador, em português)</a>, e o Parse segue esse padrão. Não aprofundarei o conceito de MVC aqui. Apenas saiba que a instância de uma visão para uma coleção de blogs gera o HTML necessário e administra todos seus eventos. E uma classe <code>View</code> é o modelo abstrato para esse tipo de instância.</p>

<p>Isso pode soar confuso, agora, mas ficará mais claro com o código. Criemos a classe <code class="inline">BlogsView</code>:</p>

<pre class="brush: javascript">var BlogsView =  Parse.View.extend({
    template: Handlebars.compile($('#blogs-tpl').html()),
	render: function(){
		var collection = { blog: this.collection.toJSON() };
		this.$el.html(this.template(collection));
	}
});</pre>

<p>Da mesma forma que estendemos a classe <code class="inline">Blog</code> a partir de <code class="inline">Parse.Object</code> e a classe <code class="inline">Blogs</code> a partir de <code class="inline">Parse.Collection</code>, você pode, simplesmente, estender uma nova classe View a partir de <code class="inline">Parse.View</code>, obtendo todos os valores e funções pré-definidas do Parse.</p>

<p>Aqui, a variável <code class="inline">template</code> busca o modelo que preparamos antes. Então, a função <code class="inline">render()</code> busca os dados em <code class="inline">this.collection</code>, converte-os para o formato JSON, renderiza-o com o modelo do handlebars, e o atribui a <code class="inline">this.$el</code>.</p>

<p>Agora, é hora de alteramos a <em>callback</em> <code class="inline">success</code> de <code class="inline">blogs.fetch()</code> para criarmos uma nova instância de BlogsView, renderizarmos essa nova instância e adicioná-la à <code class="inline">$('.main-container')</code> da página.</p>

<pre class="brush: javascript">success: function(blogs) {
    var blogsView = new BlogsView({ collection: blogs });
	blogsView.render();
	$('.main-container').html(blogsView.el);
}</pre>

<p>Perceba que, quando criamos uma nova instância de <code>BlogsView</code>, passamos um valor, <code class="inline">blogs</code>, que são os dados dos posts que obtemos do servidor do Parse, que se tornará o <code class="inline">this.collection</code> da função <code class="inline">render()</code>. E quando você colocar o HTML em <code class="inline">$('.main-container')</code>, você usará o valor de <code class="inline">blogsView.el</code>, que é o conteúdo de <code class="inline">this.$el</code>, criado pela função <code class="inline">render()</code>. (Assim, <code class="inline">blogsView.$el = $(blogsView.el)</code>). É assim que a classe <code>View</code> e a instância <code>view</code> funcionam.</p>

<p>Atualizemos a página <a href="http://localhost/blog/" rel="external" target="_blank">http://localhost/blog/</a></p>

<figure class="post_image"><img alt="Blogs rendered" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22047/image/09-blogs-rendered.png"></figure>

<p>Está funcionando! Agora, basta você enviar para sua Página do GitHub e terá um site dinâmico! Se você parar algum tempo para alterar o modelo do blog e alterar um pouco o código, você pode criar vários tipos de sites diferentes.</p>

<h2>Conclusão</h2>

<p>Você criou, hoje, sua primeira classe no Parse.com. Também aprendeu como adicionar conteúdo nessa classe, diretamente, a partir do Parse, e como renderizá-los no seu site. Você pode ter visto vários novos conceitos, mas, tenho certeza, que logo estará familiarizado com eles.</p>

<p>Na próxima parte, construiremos o painel administrativo para o sistema de blog. Você criará sua segunda classe - a classe Usuário. Também aprenderá como lidar com acesso de usuários, bem como criará duas novas visões: a de acesso e de boas vindas. Então, fique ligado, muito mais conteúdo interessante vem aí.</p>

<p>Acredito que vocês podem ficar entretidos o bastante com o que aprenderam hoje. Avisem-me caso tenham criado algo com esse tutorial. E, como sempre, verifique os arquivos de código fonte caso tenha achado algo confuso ou tenha sentido dificuldades em alguma parte.</p>

