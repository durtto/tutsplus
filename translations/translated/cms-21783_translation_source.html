<h1>Configurando o W3 Total Cache: <em>Cache</em> Avançado de Base de Dados</h1>

<p>Até agora, configuramos as opções de Redução de Arquivos (<em>minification</em>) do W3 Total Cache. Nesse tutorial, cobriremos algumas configurações mais avançadas dele.</p>

<h2><em>Cache</em> de Base de Dados</h2>

<p>O <em>cache</em> de base de dados é um fator importante a se otimizar em um site. Vejamos um exemplo de uma rede de três camadas: Hoje em dia, aplicações são publicadas em várias camadas para aprimorar a performance. Isso significa que a camada de aplicação e a camada de base de dados podem estar em servidores diferentes. A aplicação mostra os dados sob demanda.</p>

<p>Nesse caso, o gargalo é a camada de dados. Gargalo existe quando um conjunto de componentes ou recursos limita a performance ou capacidade de um sistema inteiro. Em nosso caso, esse componente/recurso será a camada de dados. </p>

<p>Fica claro que precisamos dos dados bem onde a camada de aplicação está para aumentar a performance, mas bancos de dados comerciais são pesados demais para colocá-los na mesma camada da aplicação. Assim, usamos outras bases de dados mais leves para salvar em <em>cache</em> os dados no servidor da camada da aplicação. </p>

<p>A maneira mais fácil para entender isso é levar em conta o que seu site WordPress tem de fazer para funcionar. Ele busca dados dinâmicamente através de consultas à base de dados, continuamente. Nessas horas, a base de dados salva em <em>cache</em> o resultado das consultas mais usadas, de modo que mais conteúdos estáticos possam ser retornados rapidamente.</p>

<h2>Vantagens do <em>Cache</em> de Base de Dados</h2>

<ul>
  <li>Escalabilidade</li>
  <li>Flexibilidade</li>
  <li>Disponibilidade</li>
  <li>Performance</li>
</ul>

<figure class="post_image">
  <img alt="Advance Database Cache" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/164/posts/21783/image/00.png"/>
</figure>

<h3><b>Aba <em>General</em></b></h3>

<p>Comecemos a configurar o <em>cache</em> de base de dados. Primeiro, veja a aba "General". Verifique a opção onde informamos ao <em>plugin</em> para não salvar em <em>cache</em> as consultas dos usuários que estejam logados no site. Se você usa o WordPress como um CMS e o aproveita para vender conteúdo pago, onde todo o seu tráfego se dá por meio de usuários logados, pode desabilitar essa opção.</p>

<figure class="post_image">
  <img alt="General" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/164/posts/21783/image/01.png"/>
</figure>

<h3>Aba <em>Advance</em></h3>

<h4>Tempo de Vida Máximo de Objetos em <em>Cache</em></h4>

<p>Nas configurações avançadas, a primeira configuração está com o valor de 180 segundos. Ela determina o tempo de expiração de itens não modificados e que estão em <em>cache</em>. Quão maior o valor, maior será o tamanho do <em>cache</em>. Se você quiser salvar as consultas em <em>cache</em> por mais tempo, pode aumentar esse valor. Ele aumentará drasticamente o tamanho do <em>cache</em> salvo em disco.</p>

<figure class="post_image">
  <img alt="Advanced" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/164/posts/21783/image/02.png"/>
</figure>

<h4>Intervalo da Coleta de Lixo</h4>

<p>Essa configuração define o quão frequente você deseja que o lixo de seu <em>cache</em> seja coletado/apagado do disco. Em tutoriais anteriores, selecionamos a opção "<em>Disk Type Caching</em>" que é responsável por salvar os dados do <em>cache</em> no disco do servidor. A configuração do intervalo da coleta de lixo é responsável por quão rápido isso acontece. Seu valor padrão é de 3600 e é um valor interessante para a maioria das situações.</p>

<figure class="post_image">
  <img alt="Garbage Collection" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/164/posts/21783/image/03.png"/>
</figure>

<h4>Nunca Salve em <em>cache</em> as Páginas a Seguir</h4>

<p>As páginas/URLs e diretórios definidos nessa caixa, não serão salvos em <em>cache</em>. Essa configuração pode nos ajudar quando tempos algum problema com alguma página específica ou algum diretório relevante a algum <em>plugin</em>.</p>

<figure class="post_image">
  <img alt="Uncached Pages" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/164/posts/21783/image/04.png"/>
</figure>

<h4>Fontes de Consultas Ignoradas</h4>

<p>Alguns <em>plugins</em> como o WooCommerce e outros, como <em>plugins</em> de avaliação, costumam enlouquecer por conta de <em>cache</em> de base de dados. Costumamos ignoras as consultas relevantes a esses <em>plugins</em> através dessa área. O WooCommerce e a maioria dos <em>plugins</em> mais usados já estão protegidos. Isso é, você já pode ver que há alguns valores padrão configurados para você.</p>

<p>Por exemplo, já tive problemas com o <em>plugin</em> <a href="https://wordpress.org/plugins/wp-postratings/" rel="external" target="_blank">Rating</a>, então, contatei Lester (o autor desse <em>plugin</em>) e ele disse para ignorar essas duas fontes <code class="inline">wp_postmeta</code> e <code class="inline">wp_ratings</code> no W3TC. Esse exemplo é só uma amostra de como você pode fazer para resolver esses problemas. </p>

<p>Perceba que qualquer prefixo (configurado no <code class="inline">wp-config.php</code>) será substituído pelo prefixo utilizado na configuração (o padrão é: <code>wp_</code>). Fontes de consultas podem ser identificado usando o modo de depuração. Se você ainda enfrentar problemas, leia essa <a href="http://www.pragmaticworld.com/articles/view/W3TC-blocking-your-plug-in-Here-is-a-fix" rel="external" target="_blank">solução</a>.</p>

<figure class="post_image">
  <img alt="Ignored Query Stems" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/164/posts/21783/image/05.png"/>
</figure>

<h4>Rejeitar Termos de Consulta</h4>

<p>Deixe essa opção de lado, a não ser que você saiba exatamente o que fazer (caso seja um administrador de base de dados). Essa área é usada para ignorar certos padrões de consultas que são muito importantes para serem salvos em <em>cache</em> e precisam ser executados sempre.</p>

<figure class="post_image">
  <img alt="Rejected Query Words" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/164/posts/21783/image/06.png"/>
</figure>

<p>E é isso. Cobriremos <em>cache</em> de objetos no próximo tutorial. Se tiver quaisquer questões, ficarei muito feliz em ajudar você.</p>