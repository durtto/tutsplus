<h1>50 Filtros Para WordPress: Filtros 21 a 30</h1>

<p>No artigo anterior desta série, chegamos aos 20 filtros para WordPress. Nesse tutorial, veremos outro conjunto, bem como exemplos de uso dos mesmos.</p>

<p>É hora de começar!</p>

<h2>Filtrando a Consulta de Busca</h2>

<p>A busca é uma das funcionalidades mais importantes do WordPress (apesar de ter continuado bem primitiva, sem razão aparente). Com o filtro <code>posts_search</code>, você pode mexer com o SQL da busca.</p>

<h3>Exemplo: Incluindo Artigos Protegidos por Senha nos Resultados das Buscas</h3>

<p>Digamos que você use artigos para manter informações sobre seus clientes e os configura com senha e passa essa senha para seus clientes. </p>

<p>Para permitir que seus clientes encontrem esse artigo entre os vários artigos do seu site, você pode usar o trecho de código abaixo para permitir que os visitantes possam ver os artigos protegidos por senha, listados nos resultados da busca:</p>

<pre class="brush: php">&lt;?php

add_filter( 'posts_search', 'posts_search_example' );

function posts_search_example( $search ) {
	global $wpdb;
	if( !is_user_logged_in() ) {
		$pattern = " AND ({$wpdb-&gt;prefix}posts.post_password = '')";
		$search = str_replace( $pattern, '', $search );
	}
	return $search;
}

// Código Fonte de Exemplo: http://wpsnipp.com/index.php/functions-php/include-password-protected-posts-in-search-results/

?&gt;</pre>

<p>Se os usuários do seu site forem registrados, você não precisará do trecho de código acima: eles podem ver os artigos protegidos, desde que estejam logados &mdash; mas, claro, eles ainda não poderão ver o conteúdo do artigo se não digitarem a senha correta.</p>

<h2>Configurando a Qualidade de Compressão das Imagens Enviadas</h2>

<p>Por padrão, o WordPress tenta comprimir suas imagens enquanto tenta redimensioná-las para os tamanhos de imagens definidos. Com o filtro <code>wp_editor_set_quality</code>, você pode alterar ou desabilitar a taxa de compressão.</p>

<h3>Exemplo: Previna que o WordPress Comprima &amp; Distorça suas Imagens</h3>

<p>Comprimir imagens usando o PHP resultada em leves distorções que só podem ser vistas por olhos bem atentos aos detalhes. Se seu site tem uma audiência atenta a esse tipo de detalhe (talvez designers?) e não quer que o WordPress use esse algoritmo de compressão, você pode usar o trecho abaixo para desabilitar a compressão e evitar distorção:</p>

<pre class="brush: php">&lt;?php

add_filter( 'wp_editor_set_quality', 'wp_editor_set_quality_example' );

function wp_editor_set_quality_example( $quality ) {
	return 100;
}

?&gt;</pre>

<h2>Filtrando o <em>Widget</em> de Texto</h2>

<p><em>Widgets</em> padrão no WordPress tem seus próprios filtros. O filtro <code>widget_text</code> é o filtro para, adivinhe... o <em>Widget</em> de Texto.</p>

<h3>Exemplo: Habilitando <em>Shortcodes</em> em <em>Widgets</em> de Texto</h3>

<p>É meio incômodo o WordPress não nos permitir usar <em>shortcodes</em> em <em>widgets</em> de texto por padrão. Graças a esse filtro abaixo, podemos habilitar <em>shortcodes</em> dentro desses <em>widgets</em>:</p>

<pre class="brush: php">&lt;?php

add_filter( 'widget_text', 'do_shortcode' );

?&gt;</pre>

<p>...espere, não há função para atrelarmos? Na verdade, temos sim: É uma função chamada <code>do_shortcode()</code> a qual você já ouviu falar. Uma vez que já temos uma função para atrelar ao filtro, não precisamos criar a nossa própria função.</p>

<h2>Filtrando o Conteúdo do <em>Feed</em></h2>

<p>Da mesma forma que você pode filtrar o conteúdo do artigo com o filtro <code>the_content</code>, você também pode fazê-lo com os itens do <em>feed</em>, usando o filtro <code>the_content_feed</code>.</p>

<h3>Exemplo: Inserindo Miniaturas de Imagens em Itens de <em>Feed</em></h3>

<p>Esse é exemplo é um dos meus favoritos dessa série inteira: adicionar miniaturas de imagens em itens do <em>feed</em>!</p>

<pre class="brush: php">&lt;?php

add_filter( 'the_content_feed', 'the_content_feed_example' );

function the_content_feed_example( $content ) {
	$featured_image = '';
	$featured_image = get_the_post_thumbnail( get_the_ID(), 'thumbnail', array( 'style' =&gt; 'float:left;margin-right:.75em;' ) );
	$content = get_the_excerpt() . ' &lt;a href="'. get_permalink() .'"&gt;' . __( 'Leia Mais' ) . '&lt;/a&gt;';
	if( '' != $featured_image )
		$content = '&lt;div&gt;' . $featured_image . $content . '&lt;br style="clear:both;" /&gt;&lt;/div&gt;';
	return $content;
}

?&gt;</pre>

<p>Se quiser que a miniatura seja mostrada à direita do resumo, simplesmente altere isso <code>'float:left;margin-right:.75em;'</code> para isso <code>'float:right;margin-left:.75em;'</code>.</p>

<h2>Alterando Botões do Editor Visual</h2>

<p>O WordPress vem com o TinyMCE, um editor <em>WYSIWYG</em> avançado, que usamos enquanto criamos nossos artigos. Com o filtro <code>mce_buttons</code>, podemos alterar a primeira linha de botões do editor.</p>

<h3>Exemplo: Removendo Botões Desnecessários do Editor Visual</h3>

<p>Se você mantém um blog com vários autores e não quer que os autores usem certos botões do editor visual, você pode remover alguns deles (ou todos eles), usando o código abaixo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'mce_buttons', 'mce_buttons_example' );

function mce_buttons_example( $buttons ) {
	$remove_array = array( 'strikethrough', 'blockquote', 'hr', 'alignleft', 'aligncenter', 'alignright', 'wp_more', 'wp_adv' );
	// lista completa (WP versão 3.9)
	// 'bold', 'italic', 'strikethrough', 'bullist', 'numlist', 'blockquote', 'hr', 'alignleft', 'aligncenter', 'alignright', 'link', 'unlink', 'wp_more', 'spellchecker', 'fullscreen', 'wp_adv'
	foreach( $remove_array as $remove ) {
		if ( ( $key = array_search( $remove, $buttons ) ) !== false )
			unset( $buttons[ $key ] );
	}
	return $buttons;
}

?&gt;</pre>

<p>Note que esse código não impede o uso daquilo que você está removendo &mdash; apenas remove os botões que ativam as funcionalidades.</p>

<p>Como dito, esse filtro lida a <strong>primeira linha</strong> de botões do editor visual. Para a segunda linha (os "botões avançados"), há outro filtro, chamado de <code>mce_buttons_2</code> e há outros dois filtros adicionais para duas linhas vazias: <code>mce_buttons_3</code> e <code>mce_buttons_4</code>.</p>

<h2>Excluindo Termos de Listas</h2>

<p>Há momentos que você precisa "excluir" um termo de toda e cada lista em seu site. Esse pequeno filtro nos permite realizar esse feito.</p>

<h3>Exemplo: Excluindo Categorias que <em>Plugins</em> Criam</h3>

<p>Imagine que você criou uma <em>plugin</em> que precisou criar duas categorias: "Favorited-MyPlugin" e "Hated-MyPlugin". Ficaria feio se ambas aparecessem na lista de categorias, então você precisa <em>escondê-las</em> das listas. É assim que se faz:</p>

<pre class="brush: php">&lt;?php

add_filter( 'list_terms_exclusions', 'list_terms_exclusions_example', 10, 2 );

function list_terms_exclusions_example( $exclusions, $args ) {
	// IDs dos termos a serem excluídos
	$exclude = "42,132";
	$exterms = wp_parse_id_list( $exclude );
	foreach ( $exterms as $exterm ) {
		if ( empty( $exclusions ) )
			$exclusions  = ' AND ( t.term_id &lt;&gt; ' . intval( $exterm ) . ' ';
		else
			$exclusions .= ' AND t.term_id &lt;&gt; ' . intval( $exterm ) . ' ';
	}
	if ( !empty( $exclusions ) )
		$exclusions .= ')';
	return $exclusions;
}

// Código Fonte de Exemplo: http://shailan.com/2598/how-to-exclude-categories-and-tags-from-your-widgets/

?&gt;</pre>

<p>Eis um ponto interessante: Esse filtro esconde os termos do seu painel administrativo também. Legal... <em>e estranho</em>.</p>

<h2>Alterando Menu Suspenso dos Tamanhos de Imagem</h2>

<p>Se você escolhe uma imagem para usar em seus artigos, você tem de escolher o tamanho delas antes de adicioná-las ao conteúdo do artigo. Esse filtro útil nos permite adicionar tamanhos customizados de imagens (criados anteriormente com a função <code>add_image_size()</code>) ao menu suspenso onde selecionamos os tamanhos das imagens.</p>

<h3>Exemplo: Permitindo Autores Escolherem Tamanhos Customizados para Imagens</h3>

<p>Suponha que você já criou os tamanhos customizados de imagens, incluindo um que se chama "miniatura-proporcao-divina", e você precisa que seus autores adicionem imagens aos artigos, com esse tamanho, quando necessário. Eis como você adiciona o tamanho customizado ao menu suspenso <code>&lt;select&gt;</code>:</p>

<pre class="brush: php">&lt;?php

add_filter( 'image_size_names_choose', 'image_size_names_choose_example' );

function image_size_names_choose_example( $sizes ) {
	return array_merge( $sizes, array(
		'miniatura-proporcao-divina' =&gt; __( 'Miniatura Proporção Divina' )
	) );
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/image_size_names_choose

?&gt;</pre>

<p>É bem fácil, não é?</p>

<h2>Alterando a Cadeia de Caractere "Leia Mais" em Resumos</h2>

<p>O WordPress pega as primeiras 55 palavras dos seus artigos, remove a formatação e chama isso de "resumos" de artigos. Ao final dos resumos, há uma cadeia de caracteres <code>[...]</code>, que é bem esquisita, ao meu ver. Felizmente, com o filtro <code>excerpt_more</code> podemos alterá-la.</p>

<h3>Exemplo: Adicionando um <em>Link</em> para o Artigo, Após o Resumo</h3>

<p>Digamos que você quer alterar esse texto e transformá-lo em um <em>link</em> para o artigo. Eis como fazê-lo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'excerpt_more', 'excerpt_more_example' );

function excerpt_more_example( $text ) {
	global $post;
	return '... &lt;a class="read-more-link" href="' . get_permalink( $post-&gt;ID ) . '"&gt;Leia Mais&lt;/a&gt;';
}

?&gt;</pre>

<p>Agora, aquele trecho de texto será bem utilizado.</p>

<h2>Administrando Colunas em Listas de Artigos</h2>

<p>Na página de artigos (<em>posts</em>) em seu painel administrativo, você pode ver uma lista de todos seus artigos em uma tabela, com informações como autores, categorias, <em>tags</em>, etc. </p>

<p>O filtro <code>manage_posts_columns</code> nos permite esconder essas colunas ou adicionar outras (através do uso de ações e funções de ação).</p>

<h3>Exemplo: Removendo a Coluna "Autor"</h3>

<p>Se você for o único autor no site, você não precisa ver a coluna de autores para cada artigo. Assim, talvez queira remover essa coluna para economizar espaço na tela. Eis como se faz:</p>

<pre class="brush: php">&lt;?php

add_filter( 'manage_posts_columns', 'manage_posts_columns_example' );

function manage_posts_columns_example( $columns ) {
	unset( $columns['author'] );
	return $columns;
}

?&gt;</pre>

<p>E pronto! Por padrão, há sete colunas que podem ser escondidas:</p>

<ul>
  <li><code>cb</code> (os <em>checkboxes</em>)</li>
  <li><code>title (o título do artigo)</code></li>
  <li><code>author (os autores)</code></li>
  <li><code>categories (as categorias)</code></li>
  <li><code>tags (as <em>tags</em>)</code></li>
  <li><code>comments (a quantidade de comentários)</code></li>
  <li><code>date (a data)</code></li>
</ul>

<p>[tip]Para fazer isso funcionar em tipos de artigos customizados, você pode usar o filtro <code>manage_$post_type_posts_columns</code>, onde <code>$post_type</code> é o nome ajustado (<em>slug</em>) do seu artigo customizado.[/tip]</p>

<h2>Editando as Formas de Contatos dos Usuários</h2>

<p>Você sabia que você pode adicionar (ou remover) campos dos perfis do usuário? Sim, é para isso que o filtro <code>user_contactmethods</code> serve.</p>

<h3>Exemplo: Adicionando Campos para as Redes Socais dos Usuários</h3>

<p>Esse trecho é bem popular porque o WordPress ainda tem campos de perfis como do "Jabber" e "AIM", e o pessoal quer removê-los. Nesse exemplo, removeremos algumas das "formas de contato padrão" e adicionaremos alguns <em>novos</em> campos ao perfil:</p>

<pre class="brush: php">&lt;?php

add_filter( 'user_contactmethods', 'user_contactmethods_example' );

function user_contactmethods_example( $contactmethods ) {
	unset( $contactmethods['yim'] );
	unset( $contactmethods['aim'] );
	unset( $contactmethods['jabber'] );
	$contactmethods['facebook']		= 'Facebook';
	$contactmethods['twitter']		= 'Twitter';
	$contactmethods['gplus']		= 'Google+';
	$contactmethods['linkedin']		= 'LinkedIn';
	$contactmethods['instagram']	= 'Instagram';
	return $contactmethods;
}

?&gt;</pre>

<p>Os campos de perfil agora estão com muito mais cara de 2014 e menos de 2002, certo?</p>

<h2>Fim da Parte Três</h2>

<p>Nós passamos pelo terceiro conjunto dos 50 filtros, deste artigo. Espero que você tenha gostado e aprendido coisas novas. Vejo você no próximo artigo!</p>

<p>Gostaria de saber o que vocês têm achado desta série. Tem gostado dos filtros selecionados? Deixe seus comentários, logo abaixo. E, caso tenha curtido o artigo, não esqueça de compartilhá-lo!</p>