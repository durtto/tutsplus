<h1>Desenvolvendo <em>Plugins</em> para Sua <em>Framework</em> para Temas de WordPress</h1>

<p>No artigo anterior, exploramos os meios que podemos usar <a href="https://code.tutsplus.com/tutorials/creating-child-themes-for-your-wordpress-theme-framework--cms-21933" target="_self">temas filhos</a> para criar sites usando sua <em>framework</em>. Nesse tutorial, veremos as várias ocasiões em que você, talvez, queira criar <em>plugins</em>.</p>

<h2>Decidindo Quando Criar Um <em>Plugin</em></h2>

<p>Às vezes, pode ser difícil decidir se se deve usar um <em>plugin</em> ou o arquivo <code class="inline">functions.php</code> do seu tema filho quando se quer adicionar funcionalidade a um site usando sua <em>framework</em>.</p>

<p>Ao tentar decidir o que fazer, sempre me pergunto algumas coisas, como documentado nesse infográfico:</p>

<figure class="post_image"><img alt="" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/227/posts/21934/image/wordpress-theme-frameworks-plugin-or-functions-small.png"></figure>

<p>Isso ajudará você a decidir se deve usar o arquivo de funções do tema filho ou pai, um <em>plugin</em> ou seu tema filho inicial.</p>

<p>Se a funcionalidade requiser a adição de muito código e é útil para outras pessoas, ou será usados em outros sites que você criará, mesmo que não em todos, criar um <em>plugin</em>, geralmente, é uma boa ideia.</p>

<h2>Criando Seus <em>Plugins</em></h2>

<p>Se você decidiu criar um <em>plugin</em>, então você precisa lançar mão dos ganchos que você adicionou à sua <em>framework</em> para torná-los ainda mais poderosos. Por exemplo:</p>

<ul><li>Se seu <em>plugin</em> adiciona uma funcionalidade de <em>rastro migalha de pão</em> (<em>breadcumbs</em>), você pode anexá-lo ao gancho de ação <code class="inline">wptp_above_content</code> para mostrar o <em>rastro migalha de pão</em> acima do conteúdo de cada página.</li>
<li>Se seu <em>plugin</em> criar um campo de busca mais poderoso ou relevante, você pode adicioná-lo aos ganchos de ação <code class="inline">wptp_in_header</code> ou <code class="inline">wptp_sidebar</code>.</li>
<li>Um <em>plugin</em> que cria uma caixa de ação (semelhante à função do tutorial passado sobre <a href="https://code.tutsplus.com/tutorials/creating-child-themes-for-your-wordpress-theme-framework--cms-21933" target="_self">temas filhos</a>) poderia ser anexado aos ganchos <code class="inline">wptp_sidebar</code> ou <code class="inline">wptp_after_content</code>.</li>
</ul>

<p>E a lista continua!</p>

<p>Obviamente, também existirá <em>plugins</em> que não usarão os ganchos da sua <em>framework</em>, mas, ao invés disso, ativará ganchos do <em>core</em> do WordPress. Porém, ter seus próprios ganchos dão opções extras.</p>

<h3>Exemplo de <em>Plugin</em> de Navegação</h3>

<p>Um exemplo é o <em>plugin</em> de navegação que criei para usar com minha própria <em>framework</em>. Ele só é ativado em <strong>Páginas</strong> e, primeiramente, checa onde a página atual está na hierarquia. Se a Página tem filhos ou Páginas pais, ele mostra a Página raiz da hierarquia juntamente de uma lista com suas páginas filhas, dando-lhe uma navegação local.</p>

<p>Usei esse <em>plugin</em> em sites de clientes e o anexei ao gancho <code class="inline">before_content</code> ou ao gancho da <code class="inline">sidebar</code>, algumas vezes em ambos, com <em>tags</em> condicionais extras.</p>

<p>O <em>plugin</em> usa duas funções: a primeira, <code class="inline">wptp_check_for_page_tree()</code>, localiza onde a página fica na árvore de páginas:</p>

<pre class="brush: php">function wptp_check_for_page_tree() {

    // primeiro, verifica se estamos em uma página
    if( is_page() ) {

	    global $post;

	    // depois, checa se a página tem pais
	    if ( $post-&gt;post_parent ) {

		    // busca uma lista dos ancestrais
		    $parents = array_reverse( get_post_ancestors( $post-&gt;ID ) );

		    // pega o ancestral raiz
		    return $parents[0];

		}

		// retorna o id - esse será o ancestral raiz, caso haja algum, ou a
    // página atual, caso não exista
		return $post-&gt;ID;

	}

}</pre>

<p>A outra função, <code class="inline">wptp_list_subpages()</code>, verifica se estamos em uma página que não a página inicial, e executa a função <code class="inline">wptp_check_for_page_tree()</code>. Baseado no resultado dessa função, mostra a lista de página:</p>

<pre class="brush: php">function wptp_list_subpages() {

    // não executa na página principal do blog
    if ( is_page() &amp;&amp; ! is_home() ) {

	    // executa a função wptp_check_for_page_tree para buscar a página raiz
	    $ancestor = wptp_check_for_page_tree();

	    // configura os argumentos para as páginas filhas do ancestral
	    $args = array(
		    'child_of' =&gt; $ancestor,
		    'depth' =&gt; '-1',
		    'title_li' =&gt; '',
	    );

	    // configura o valor de get_pages para verificar se está vazio
	    $list_pages = get_pages( $args );

	    // verifica se $list_pages tem valores
	    if ( $list_pages ) {

		    // abre uma lista com o ancestral no topo
			?&gt;
		    &lt;ul class="page-tree"&gt;
			    &lt;?php // lista a página ancestral ?&gt;
			    &lt;li class="ancestor"&gt;
				    &lt;a href="&lt;?php echo get_permalink( $ancestor ); ?&gt;"&gt;&lt;?php echo get_the_title( $ancestor ); ?&gt;&lt;/a&gt;
			    &lt;/li&gt;

			    &lt;?php
			    // use a função wp_list_pages para listar as páginas do acestral
          // ou da página atual
			    wp_list_pages( $args );

			    // fecha a lista da árvore de páginas
			    ?&gt;
			&lt;/ul&gt;

		&lt;?php
		}
	}

}</pre>

<p>Tendo instalado e ativado o <em>plugin</em>, você terá de ativá-lo no seu tema filho, através da adição do seguinte trecho de código ao arquivo <code class="inline">functions.php</code>:</p>

<pre class="brush: php">add_action( 'wptp_sidebar', 'wptp_list_subpages' );</pre>

<p>Claro, você poderia usar um gancho de ação diferente se quisesse mostrar a lista em outro lugar.</p>

<h2>Conclusão</h2>

<p><em>Plugins</em> são outra parte do ecossistema que você cria como parte da sua <em>framework</em>. Você pode criar <em>plugins</em> que são projetados, especificamente, para serem ativados a partir dos ganchos que você adicionou à sua <em>framework</em>, como mostrei mais acima.</p>

<p>Contudo, é interessante passar um tempo verificando se é, realmente, necessário criar um <em>plugin</em>: se estiver em dúvida, dê uma olhada no infográfico desse artigo. Ele ajudará você a se decidir.</p>

