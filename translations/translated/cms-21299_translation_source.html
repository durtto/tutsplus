<h1>50 Filtros Para WordPress: Filtros 41 a 50</h1>

<p>Nos artigos anteriores desta série, chegamos ao total de 40 filtros visto. Neste tutorial, veremos os últimos 10 filtros, bem como exemplos de cada um.</p>

<p>É hora de começar!</p>

<h2>Filtrando o Código do Carregador de <em>Scripts</em></h2>

<p>O WordPress tem seu próprio carregador de <em>scripts</em>, o <code>wp_enqueue_script()</code>, que nos permite a "enfileirar" arquivos JavaScript ao invés de fixá-los no código fonte das páginas. E esse pequeno filtro, chamado <code>script_loader_src</code>, permite-nos <em>alterar o comportamento</em> de como eles serão enfileirados e retornados.</p>

<h3>Exemplo: Remove the Version Parameter from Scripts</h3>

<p>Os Google Page Speed, Yahoo YSlow e outros sites de avaliação de performance de sites, geralmente, <strong>odeiam</strong> os parâmetros de URL em arquivos JavaScript. E eles tem razão: <em>Scripts</em> com parâmetros ao final de suas URLs não são guardados pelos servidores <em>proxy</em> (<a href="https://developers.google.com/speed/docs/best-practices/caching#LeverageProxyCaching">descubra mais sobre isso, nesse artigo</a>) e, infelizmente, o WordPress habilita parâmetros de "versão" para <em>scripts</em> (e estilos também), por padrão. Por sorte, podemos remover esse parâmetro <code>ver</code> com algumas poucas linhas de código:</p>

<pre class="brush: php">&lt;?php

function script_loader_src_example( $src ) {
	return remove_query_arg( 'ver', $src );
}

add_filter( 'script_loader_src', 'script_loader_src_example' );
// Dica bônus: Você também pode fazer isso com estilos!
add_filter( 'style_loader_src', 'script_loader_src_example' );

// Código Fonte de Exemplo: http://www.wpmayor.com/15-practical-ways-boost-wordpress-speed/

?&gt;</pre>

<p>Pronto! Seus arquivos JavaScript (e CSS) não terão mais o parâmetro de versão.</p>

<p>Se quiser aprender mais sobre uso apropriado do JavaScript com o WordPress, tenha certeza de <a href="http://code.tutsplus.com/articles/the-complete-guide-to-proper-javascript-usage-with-wordpress--wp-32172">dar uma olhada nesse meu outro artigo sobre o tópico</a>.</p>

<h2>Adicionando HTML à <em>Metabox</em> da "Imagem Destacada"</h2>

<p>O filtro <code>admin_post_thumbnail_html</code>, como o nome sugere, permite que você adicione conteúdo HTML dentro da <em>Metabox</em> da "Imagem Destacada". O HTML aparecerá logo abaixo do link "Escolher imagem destacada".</p>

<h3>Exemplo: Ajudando Seu Cliente a Configurar Corretamente Imagens Destacadas</h3>

<p>Imagine que você está criando um blog pessoal para seu cliente, mas ele insiste em manter o blog por conta própria ao invés de contratar um assistente. Ele sempre esquece de adicionar uma imagem destacada (Ele chama de "imagem do topo") e você precisa deixar um lembrete na página de <em>Novo Post</em>. Eis como se faz:</p>

<pre class="brush: php">&lt;?php

add_filter( 'admin_post_thumbnail_html', 'admin_post_thumbnail_html_example' );

function admin_post_thumbnail_html_example( $html ) {
	return $html .= '&lt;p&gt;Olá Sr. Smith! Clique em adicionar imagem e escolha a imagem do topo. Lembre-se: &lt;strong&gt;A largura dela deve ter, pelo menos, 900px&lt;/strong&gt;!&lt;/p&gt;';

}

?&gt;</pre>

<p>Com seu utilíssimo lembre-te, seu cliente nunca esquecerá de configurar a "imagem do topo" com uma largura de, pelo menos, 900px.</p>

<h2>Controlando Enxurrada de Ataques de Comentários - <a href="http://codex.wordpress.org/Plugin_API/Filter_Reference/comment_flood_filter"><code>comment_flood_filter</code></a></h2>

<p>Por padrão, o WordPress previne que pessoas comentem repetidamente em seus artigos, tentando evitar o conhecido "<em>flood</em>" (enxurrada). Por exemplo, se um visitante comentar em um artigo em seu site, ele deve esperar 15 segundos (valor padrão), antes de comentar novamente. Esse filtro permite você alterar esse valor - ou desabilitar a verificação de enxurrada.</p>

<h3>Exemplo: Fazendo Comentaristas Esperarem Mais</h3>

<p>Como disse, o WordPress faz com que o visitante espere por 15 segundos antes de comentar novamente. Em alguns cenários, é preciso aumentar esse valor para, digamos, 60 segundos. Eis como se faz:</p>

<pre class="brush: php">&lt;?php

add_filter( 'comment_flood_filter', 'comment_flood_filter_example', 10, 3 );

function comment_flood_filter_example( $flood_control, $time_last, $time_new ) {
	$seconds = 60;
	if ( ( $time_new - $time_last ) &lt; $seconds )
		return true;
	return false;
}

// Código Fonte de Exemplo: http://codex.wordpress.org/FAQ_Working_with_WordPress#How_do_I_prevent_comment_flooding.3F

?&gt;</pre>

<p>Alterando o valor "60" no trecho acima para o valor que desejar.</p>

<h3>Exemplo Bônus: Desabilitando a Verificação de Enxurrada de Comentários</h3>

<p>Se você não se importa com a velocidade de comentários dos visitantes, você pode desabilitar a verificação de enxurrada usando as duas linhas abaixo:</p>

<pre class="brush: php">&lt;?php

remove_all_filters( 'comment_flood_filter' );
add_filter( 'comment_flood_filter', '__return_false', 10, 3 );

?&gt;</pre>

<p>Notou a função <code>remove_all_filters()</code>? Como o nome sugere, ela remove todas as funções de filtros de um gancho de filtro.</p>

<h2>Alterando a Quantidade de Itens Visto na Seção "Agora"</h2>

<p>A seção "Agora" nos mantém atualizados sobre quantos artigos, páginas e comentários estão na base de dados do seu site. O filtro <code>dashboard_glance_items</code> ajuda-nos a mostrar informações adicionais, como o número de artigos customizados.</p>

<h3>Exemplo: Mostrando o Tipo de Post "Evento" na Seção "Agora"</h3>

<p>Imaginemos que você tenha um blog para eventos, onde você mantém os visitantes informados sobre novos locais de eventos, os quais você publica como um artigo customizado, chamado "Eventos" (e com o identificador <code>event</code>). Para vermos a quantidade de eventos em seu blog, você pode usar a função abaixo e atrelá-la ao filtro <code>dashboard_glance_items</code> dessa forma:</p>

<pre class="brush: php">&lt;?php

add_filter( 'dashboard_glance_items', 'dashboard_glance_items_example' );

function dashboard_glance_items_example( $items = array() ) {
	$post_types = array( 'evento' );
	foreach( $post_types as $type ) {
		if( ! post_type_exists( $type ) ) continue;
		$num_posts = wp_count_posts( $type );
		if( $num_posts ) {
			$published = intval( $num_posts-&gt;publish );
			$post_type = get_post_type_object( $type );
			$text = _n( '%s ' . $post_type-&gt;labels-&gt;singular_name, '%s ' . $post_type-&gt;labels-&gt;name, $published, 'your_textdomain' );
			$text = sprintf( $text, number_format_i18n( $published ) );
			if ( current_user_can( $post_type-&gt;cap-&gt;edit_posts ) ) {
			$output = '&lt;a href="edit.php?post_type=' . $post_type-&gt;name . '"&gt;' . $text . '&lt;/a&gt;';
				echo '&lt;li class="post-count ' . $post_type-&gt;name . '-count"&gt;' . $output . '&lt;/li&gt;';
			} else {
			$output = '&lt;span&gt;' . $text . '&lt;/span&gt;';
				echo '&lt;li class="post-count ' . $post_type-&gt;name . '-count"&gt;' . $output . '&lt;/li&gt;';
			}
		}
	}
	return $items;
}

// Código Fonte de Exemplo: http://www.trickspanda.com/2014/03/add-custom-post-types-glance-dashboard-widget-wordpress/

?&gt;</pre>

<p>Fácil, certo? Altere o valor da variável <code>$post_types</code> (vetor) para adequar-se às suas necessidades.</p>

<h2>Altere as Mensagens Padrão do Formulário de <em>Login</em></h2>

<p>O filtro <code>login_message</code> permite-nos editar a mensagem padrão que é retornada logo acima dos formulários de <em>login</em> de nossas instalações WordPress (Não são os "erros", apenas as mensagens tradicionais).</p>

<h3>Exemplo: Alterando as Mensagens Padrão de "Perdeu Senha"</h3>

<p>Se você quiser simplificar as instruções para "perdeu a senha" ("Digite seu nome de usuário ou endereço de e-mail. Você receberá um link para criar uma nova senha via e-mail."), você pode alterá-la assim:</p>

<pre class="brush: php">&lt;?php

add_filter( 'login_message', 'login_message_example' );

function login_message_example( $message ) {
	$action = $_REQUEST['action'];
	if( $action == 'lostpassword' ) {
		$message = '&lt;p class="message"&gt;Digite um endereço de e-mail e verifique sua caixa de entrada para o link de recuperação de senha!&lt;/p&gt;';
		return $message;
	}
	return;
}

// Código Fonte de Exemplo: http://www.pypelineweb.com/blog/change-wordpress-login-message-filter-it-out/

?&gt;</pre>

<p>Há inúmeras <code>ações</code> que podem ser encontradas no arquivo <code>wp-login.php</code>:</p>

<ul>
  <li><code>logout</code></li>
  <li><code>lostpassword</code> e <code>retreivepassword</code> (apelido)</li>
  <li><code>resetpass</code> e <code>rp</code> (apelido)</li>
  <li><code>register</code></li>
  <li><code>login</code></li>
</ul>

<p>Assim como fizemos em nosso exemplo, você pode escrever mensagens diferences para <code>ações</code> diferentes.</p>

<h2>Alterando Mensagens de Atualização em Massa</h2>

<p>Existem mensagens mostradas quando você atualiza, remove, recupera ou apaga artigos. Se quiser alterar essas mensagens, o filtro <code>bulk_post_updated_messages</code> é seu amigo.</p>

<h3>Exemplo: Criando Mensagens Customizadas para Tipos de Post Customizado</h3>

<p>Digamos que você não goste das mensagens apresentadas para as ações em massa dos seus artigos customizados para o tipo "evento" e quer alterá-las. Eis como se faz:</p>

<pre class="brush: php">&lt;?php

add_filter( 'bulk_post_updated_messages', 'bulk_post_updated_messages_example', 10, 2 );

function bulk_post_updated_messages_example( $bulk_messages, $bulk_counts ) {
	$bulk_messages['evento'] = array(
		'updated'   =&gt; _n( '%s evento atualizado.', '%s eventos atualizados.', $bulk_counts['updated'] ),
		'locked'	=&gt; _n( '%s evento não atualizado, alguém está editando-o.', '%s eventos não atualizados, eles devem estar sob edição.', $bulk_counts['locked'] ),
		'deleted'   =&gt; _n( '%s evento apagado permanentemente.', '%s eventos apagados permanentemente.', $bulk_counts['deleted'] ),
		'trashed'   =&gt; _n( '%s evento movido para a Lixeira.', '%s eventos movidos para a Lixeira.', $bulk_counts['trashed'] ),
		'untrashed' =&gt; _n( '%s evento restaurado da Lixeira.', '%s eventos restaurados da Lixeira.', $bulk_counts['untrashed'] ),
	);

	return $bulk_messages;
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/bulk_post_updated_messages

?&gt;</pre>

<p>Fácil, não é? Lembre-se de <a href="http://codex.wordpress.org/I18n_for_WordPress_Developers#Strings_for_Translation">tornar as mensagens traduzíveis</a> se não for o único a usar o <em>plugin</em> ou tema.</p>

<h2>Filtrando o <em>Widget</em> de Categorias Padrão</h2>

<p>Em alguns casos, você pode alterar o <em>widget</em> padrão de Categorias. Com o filtro <code>widget_categories_args</code> você pode fazer isso.</p>

<h3>Exemplo: Excluindo Categorias do <em>Widget</em></h3>

<p>Se você já quis "esconder" algumas categorias do <em>widget</em> de Categorias, use o código abaixo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'widget_categories_args', 'widget_categories_args_example' );

function widget_categories_args_example( $cat_args ) {
	$exclude_arr = array( 4, 10 );

	if( isset( $cat_args['exclude'] ) &amp;&amp; !empty( $cat_args['exclude'] ) )
		$exclude_arr = array_unique( array_merge( explode( ',', $cat_args['exclude'] ), $exclude_arr ) );
	$cat_args['exclude'] = implode( ',', $exclude_arr );
	return $cat_args;
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/widget_categories_args

?&gt;</pre>

<p>Altere o vetor <code>$exclude_arr</code> com os IDs das categorias não desejadas e pronto.</p>

<h2>Redirecionando o Usuário Após Registro</h2>

<p>Por padrão, o WordPress só lembra você de verificar seu e-mail após o registro e não o redireciona para qualquer outro lugar. Com o filtro <code>registration_redirect</code>, contudo, você pode configurar um endereço <em>seguro</em> que servirá de redirecionamento após registros bem sucedidos.</p>

<h3>Exemplo: Permitindo Novos Usuários Baixarem Seu Novo Livro</h3>

<p>Se você oferecer um livro gratuito para os visitantes que se registrarem em seu site, você pode redirecioná-los para a página que contém o <em>link</em> para <em>download</em>, usando o trecho de código abaixo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'registration_redirect', 'registration_redirect_example' );

function registration_redirect_example() {
	return home_url( '/nome-livro-gratuito/' );
}

// Código Fonte de Exemplo: http://wpsnipp.com/index.php/functions-php/redirect-a-successful-registration-page/

?&gt;</pre>

<p>Lembre-se, o redirecionamento é feito usando a função <code>wp_safe_redirect()</code>. Isso significa que você não pode redirecionar para sites externos, <strong>a não ser</strong> que tenha usado o filtro <code>allowed_redirect_hosts</code> para especificar servidores "seguros". Vimos esse filtro no primeiro artigo, então, tenha certeza de ler o tutorial, caso não o tenha ainda.</p>

<h2>Alterando Campos do Formulário de Comentário</h2>

<p>O WordPress possui a função <code>comment_form()</code> para mostrar o formulário de contato, e você pode alterar seus campos <a href="http://codex.wordpress.org/Function_Reference/comment_form">usando os argumentos dessa função</a>. Se estiver desenvolvendo um <em>plugin</em>, porém, você não será capaz de alterar qualquer parâmetro dela. Esse pequeno filtro nos permite alterar o código HTML padrão dos campos do formulário, ou até removê-los.</p>

<h3>Exemplo: Removendo o Campo de URL do Formulário de Comentários</h3>

<p>Digamos que você, enquanto um projetista da web autônomo, tem criado um <em>plugin</em> de "ajustes padrão" para todos os seus clientes e, por segurança, decide remover os campos de URL dos formulários de comentário de todos os sites. Você pode criar uma simples função para conseguir esse efeito:</p>

<pre class="brush: php">&lt;?php

add_filter( 'comment_form_default_fields', 'comment_form_default_fields_example' );

function comment_form_default_fields_example( $fields ) {
	unset( $fields['url'] );
	return $fields;
}

// Código Fonte de Exemplo: http://wpsnipp.com/index.php/comment/remove-unset-url-field-from-comment-form/

?&gt;</pre>

<p>Cole esse trecho de código no arquivo do seu <em>plugin</em> e pronto!</p>

<h2>Alterando a Lista de Tipos de Arquivos Aceitos</h2>

<p>Por padrão, você pode enviar um certo número de tipos de arquivos para sua Biblioteca de Mídia do WordPress – <a href="http://codex.wordpress.org/Uploading_Files">veja a lista completa de tipos de arquivos aqui</a>. Com a ajuda do filtro <code>upload_mime</code>, você pode alterar a lista de tipos permitidos.</p>

<h3>Exemplo: Prevenir o Envio de GIFs</h3>

<p>Ah, os GIFs... eles eram bastante populares em 1999 e continuam sendo em 2014. Você sabia que o primeiro <strong>meme</strong> foi <a href="http://knowyourmeme.com/memes/dancing-baby">um GIF de um bebê dançando</a>? Eram bons tempos onde criávamos "páginas" no <em>Yahoo! Geocities</em> e curtíamos o som enjoado do ICQ, toda vez que alguém entrava em contato conosco...</p>

<p>Continuando... Se quiser proibir o envio de GIFs para seus sites, você pode desabilitá-lo usando o trecho de código abaixo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'upload_mimes', 'upload_mimes_example' );

function upload_mimes_example( $existing_mimes = array() ) {
	unset( $existing_mimes['gif'] );
	return $existing_mimes;
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/upload_mimes

?&gt;</pre>

<p>Adeus, vídeos de quatro segundos que basta serem vistos uma vez, porém, continuam executando continuamente!</p>

<h2>Fim da Parte Cinco</h2>

<p>Hoje, passamos pelos últimos 10 filtros neste artigo. Espero que tenha gostado e aprendido coisas novas com ele. No próximo artigo, recapitularemos o que vimos e encerraremos a série. Até lá!!</p>

<p>Gostaria de saber o que vocês têm achado desta série. Tem gostado dos filtros selecionados? Deixe seus comentários, logo abaixo. E, caso tenha curtido o artigo, não esqueça de compartilhá-lo!</p>