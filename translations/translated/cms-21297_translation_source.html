<h1>50 Filtros Para WordPress: Filtros 31-40</h1>

<p>No artigo anterior dessa série, passamos por 30 filtros do WordPress. Nesse artigo de hoje, continuaremos essa tendência, revisando outro conjunto, bem como apresentaremos alguns exemplos para cada.</p>

<p>É hora de começar!</p>

<h2>Filtrando os Estilos Padrão da Galeria</h2>

<p>O WordPress estiliza o <em>shortcode</em> <code>[gallery]</code> com alguns códigos CSS pré-definidos. Você pode alterar esse comportamento usando o filtro <code>use_default_gallery_style</code>.</p>

<h3>Exemplo: Desabilite o CSS Padrão</h3>

<p>Se já tiver estilizado suas galerias no arquivo <code>style.css</code> do seu tema e não precisa das regras CSS padrão delas, você pode desabilitá-las usando o trecho de código abaixo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'use_default_gallery_style', '__return_false' );

?&gt;</pre>

<p>Pronto! Agora, o WordPress não adicionará uma <em>tag</em> <code>&lt;style&gt;</code> com todas as regras CSS antes de seus <em>shortcodes</em> <code>[gallery]</code>.</p>

<h2>Filtrando URLs de Anexos</h2>

<p>Esse filtro se aplica às URLs de anexos buscadas pela função de mesmo nome, <code>wp_get_attachment_url()</code>.</p>

<h3>Exemplo: Evitando Avisos de "Conteúdo Misto"</h3>

<p>Se estiver usando criptografia SSL em seu site, a função <code>wp_get_attachment_url()</code> pode acabar retornando uma URL iniciando em HTTP ao invés de HTTPS, o que resultaria em um aviso de "conteúdo misto" para seus visitantes. Com a função abaixo, você pode prevenir que esse aviso seja apresentado:</p>

<pre class="brush: php">&lt;?php

add_filter( 'wp_get_attachment_url', 'wp_get_attachment_url_example' );

function wp_get_attachment_url_example( $url ) {
	$http  = site_url( false, 'http'  );
	$https = site_url( false, 'https' );

	if ( $_SERVER['HTTPS'] == 'on' )
		return str_replace( $http, $https, $url );
	else
		return $url;
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/wp_get_attachment_url

?&gt;</pre>

<h2>Configurando o Tipo Padrão de Conteúdo para os E-mail</h2>

<p>Por padrão, só podemos enviar e-mails em texto simples no WordPress, uma vez que a função <code>wp_mail()</code> usa <code>text/plain</code> como tipo de conteúdo. Com o filtro <code>wp_mail_content_type</code> você pode alterar esse comportamento.</p>

<h3>Exemplo: Enviando E-mails com WordPress usando HTML</h3>

<p>Se quiser ser capaz de enviar e-mails em HTML, você pode usar o trecho de código abaixo para alterar o tipo de conteúdo para e-mails do WordPress:</p>

<pre class="brush: php">&lt;?php

add_filter( 'wp_mail_content_type', 'wp_mail_content_type_example' );

function wp_mail_content_type_example( $content_type ) {
	return 'text/html';
}

?&gt;</pre>

<h2>Guardando o Endereço de IP dos Comentaristas</h2>

<p>O WordPress guarda o endereço de IP de cada comentarista na tabela <code>comments</code> de sua base de dados. Se quiser mexer com isso, você pode usar o filtro <code>pre_comment_user_ip</code>.</p>

<h3>Exemplo: Guardando o <em>Verdadeiro</em> Endereço de IP do Comentarista</h3>

<p>Se um comentarista usar um servidor <em>proxy</em> para enviar algum comentário, o WordPress guardará o endereço de IP deste servidor ao invés do IP verdadeiro do comentarista. O verdadeiro IP é servido através de outro cabeçalho HTTP, o <code>X-Forwarded-For</code>. O trecho de código abaixo tem a funcionalidade necessária para tanto, extraindo o verdadeiro endereço de IP e guardando-o na sua base de dados:</p>

<pre class="brush: php">&lt;?php

add_filter( 'pre_comment_user_ip', 'pre_comment_user_ip_example' );

function pre_comment_user_ip_example() {
	$REMOTE_ADDR = $_SERVER['REMOTE_ADDR'];
	if ( !empty( $_SERVER['X_FORWARDED_FOR'] ) ) {
		$X_FORWARDED_FOR = explode( ',', $_SERVER['X_FORWARDED_FOR'] );
		if ( !empty( $X_FORWARDED_FOR ) )
			$REMOTE_ADDR = trim( $X_FORWARDED_FOR[0] );
	} elseif( !empty( $_SERVER['HTTP_X_FORWARDED_FOR'] ) ) {
		$HTTP_X_FORWARDED_FOR = explode( ',', $_SERVER['HTTP_X_FORWARDED_FOR'] );
		if ( !empty( $HTTP_X_FORWARDED_FOR ) )
			$REMOTE_ADDR = trim( $HTTP_X_FORWARDED_FOR[0] );
	}
	return preg_replace( '/[^0-9a-f:\., ]/si', '', $REMOTE_ADDR );
}

// Código Fonte de Exemplo: https://codex.wordpress.org/Plugin_API/Filter_Reference/pre_comment_user_ip

?&gt;</pre>

<p>Se quiser saber alguma coisa a mais sobre o cabeçalho HTTP <code>X-Forwarded-For</code>, <a href="http://en.wikipedia.org/wiki/X-Forwarded-For">visite a Wikipedia para informação adicional</a>.</p>

<h2>Alterando o Número de Revisões a Serem Salvas para Cada Artigo</h2>

<p>Provavelmente, você já sabe que o WordPress possui uma funcionalidade que nos permite salvar "revisões" de nossos artigos. Talvez você também saiba que é possível alterar o número de revisões guardadas, através da adição de uma constante (<code>WP_POST_REVISIONS</code>) no arquivo <code>wp-config.php</code>. </p>

<p>Mas, você sabia que é possível alterar o número de revisões para diferentes tipos de <em>posts</em>, até mesmo para dois artigos diferentes?? Sim, é para isso que o filtro <code>wp_revisions_to_keep</code> serve.</p>

<h3>Exemplo: Desabilitando Revisões para um Tipo Específico de <em>Post</em>
Customizado</h3>

<p>Basicamente, você alterar quantas revisões manter, brincando com a variável <code>$post</code>, mas manteremos as coisas simples e limitaremos o número de revisões para um tipo de <em>post</em> customizado, que, nesse exemplo, chamaremos de "evento":</p>

<pre class="brush: php">&lt;?php

add_filter( 'wp_revisions_to_keep', 'wp_revisions_to_keep_example', 10, 2 );

function wp_revisions_to_keep_example( $num, $post ) {
	if ( 'evento' == $post-&gt;post_type ) {
		return 0;
}
	return $num;
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/wp_revisions_to_keep

?&gt;</pre>

<p><a href="http://codex.wordpress.org/Class_Reference/WP_Post">Você pode ver o guia rápido para a variável <code>$post</code> no Codex</a>, e descobrir novas maneiras de usar esse filtro. Não esqueça de comentar e compartilhar suas ideias conosco, caso tenha uma ideia bacana!</p>

<h2>Reescrevendo o <em>Shortcode</em> <code>[caption]</code></h2>

<p>O <em>shortcode</em> <code>[caption]</code> deixa você envolver suas imagens com legendas. Se precisar alterar o retorno desse <em>shortcode</em>, pode usar esse filtro.</p>

<h3>Exemplo: Legendas de Imagens com Código HTML5</h3>

<p>O HTML5 nos apresenta duas novas <em>tags</em> relacionadas a imagens: <code>&lt;figure&gt;</code> e <code>&lt;figcaption&gt;</code>. Nesse exemplo, reescreveremos o código do <em>shortcode</em> <code>[caption]</code> com essas <em>tags</em>:</p>

<pre class="brush: php">&lt;?php

add_filter( 'img_caption_shortcode', 'img_caption_shortcode_example', 10, 3 );

function img_caption_shortcode_example( $empty, $attr, $content ) {
	$attr = shortcode_atts( array(
		'id'	  =&gt; '',
		'align'   =&gt; 'alignnone',
		'width'   =&gt; '',
		'caption' =&gt; ''
	), $attr );

	if ( 1 &gt; (int) $attr['width'] || empty( $attr['caption'] ) ) {
		return '';
	}

	if ( $attr['id'] ) {
		$attr['id'] = 'id="' . esc_attr( $attr['id'] ) . '" ';
	}

	$figure_atts	= $attr['id']
					. ' class="caption ' . esc_attr( $attr['align'] )
					. '" ' . 'style="max-width: ' . ( 10 + (int) $attr['width'] ) . 'px;"';

	$output  = '&lt;figure ' . $figure_atts . '&gt;';
	$output .= do_shortcode( $content );
	$output .= '&lt;figcaption&gt;' . $attr['caption'] . '&lt;/figcaption&gt;';
	$output .= '&lt;/figure&gt;';

	return $output;

}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/img_caption_shortcode

?&gt;</pre>

<p>Brinque com o código como quiser &mdash; talvez você não goste do uso de um
<code>ID</code> para a <em>tag</em> <code>&lt;figure&gt;</code>, por exemplo. Fora isso, funciona perfeitamente!</p>

<h2>Adicionando Classes de Artigos</h2>

<p>O filtro <code>body_class</code> (bem como a função homônima) é extremamente conhecida entre os desenvolvedores de WordPress. E quanto ao <code>post_class</code>? Você sabia que já um filtro (e uma função) para adicionar classes aos recipientes dos artigos?</p>

<h3>Exemplo: Adicionando uma Classe Especial ao Primeiro Artigo do <em>Loop</em></h3>

<p>Um exemplo perfeito seria a adição de uma classe customizada somente no primeiro artigo do <em>Loop</em>. Vejamos como fazer isso:</p>

<pre class="brush: php">&lt;?php

add_filter( 'post_class', 'post_class_example' );

function post_class_example( $classes ) {
	global $wp_query;
	if ( 0 == $wp_query-&gt;current_post ) {
		$classes[] = 'first-post';
}
	return $classes;
}

// Código Fonte de Exemplo: http://www.billerickson.net/code/first-post-class/

?&gt;</pre>

<p>De agora em diante, você não precisar usar a pseudo-classe <code>:first</code> em seu CSS e ficar preocupado quanto à compatibilidade dos navegadores &mdash; basta usar a classe <code>.first-post</code>!</p>

<h2>Adicionando Campos Customizados para Anexos</h2>

<p>No WordPress, anexos são bem semelhantes aos tipos customizados de <em>posts</em> e podem ser estendidos da mesma forma &mdash; só que com uma pequena diferença. O filtro <code>attachment_fields_to_edit</code> permite-nos brincar com os campos ao enviarmos ou editarmos algum anexo.</p>

<h3>Exemplo: Adicionando Informação de Licença Às Imagens Enviadas</h3>

<p>Digamos que você tenha um blog relacionado a fotografia e precisa configurar as licenças para toda e cada foto que você enviar como anexo. Dessa vez, com a ajuda das ações, poderemos adicionar um campo "Licença" para os anexos:</p>

<pre class="brush: php">&lt;?php

add_filter( 'attachment_fields_to_edit', 'attachment_fields_to_edit_example', 10, 2 );

function attachment_fields_to_edit_example( $form_fields, $post ) {
	$field_value = get_post_meta( $post-&gt;ID, 'licenca', true );
	$form_fields['licenca'] = array(
		'value' =&gt; $field_value ? $field_value : '',
		'label' =&gt; __( 'Licença' ),
		'helps' =&gt; __( 'Especifique o tipo de licença usado para essa imagem' )
	);
	return $form_fields;
}

add_action( 'edit_attachment', 'save_new_attachment_field' );

function save_new_attachment_field( $attachment_id ) {
	$license = $_REQUEST['attachments'][$attachment_id]['licenca'];
	if ( isset( $license ) ) {
		update_post_meta( $attachment_id, 'licenca', $license );
	}
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/attachment_fields_to_edit

?&gt;</pre>

<p>Uma excelente forma de como podemos estender a funcionalidade padrão do WordPress sem editar qualquer código do próprio WordPress.</p>

<h2>Alterando o Tamanho Automático do Resumo</h2>

<p>Por padrão, resumos automáticos são feitos a partir das primeiras 55 palavras de cada artigo, tendo sua formatação removida. Um número estranho, diga-se. Caso queira alterá-lo, o filtro <code>excerpt_length</code> permite que o faça.</p>

<h3>Exemplo: Altere o Tamanho Automático do Resumo</h3>

<p>Digamos que você só queira 15 palavras, já que estou usando um <em>layout</em> no estilo de Pinterest e não tenho muito espaço para resumos. Tudo que preciso fazer é retornar um número em uma função e atrelá-la a esse filtro:</p>

<pre class="brush: php">&lt;?php

add_filter( 'excerpt_length', 'excerpt_length_example' );

function excerpt_length_example( $words ) {
	return 15;
}

?&gt;</pre>

<p>Bem fácil, não é?</p>

<h2>Brincando Com Ações em Massa nas Telas Administrativas</h2>

<p>Logo acima das listas de itens nas páginas administrativas do WordPress (Como os <em>Posts</em>, Páginas, Usuários, Mídia, etc.), há algumas "ações em massa", onde você pode selecionar um conjunto de itens e realizar certas ações com eles. Esse filtro bem útil nos permite mexer com aquele pequeno menu suspenso.</p>

<h3>Exemplo: Desabilitando Exclusão em Massa de Artigos</h3>

<p>Você é dono de um site de notícias e está cansado dos editores apagarem, acidentalmente, os posts que ele precisa atualizar. Se não quiser mais que isso aconteça, você pode desabilitar a opção de exclusão em massa:</p>

<pre class="brush: php">&lt;?php

add_filter( 'bulk_actions-edit-post', 'bulk_actions_edit_post_example' );

function bulk_actions_edit_post_example( $actions ) {
	unset( $actions['trash'] );
	return $actions;
}

?&gt;</pre>

<p>[tip]A variável <code>$screenid</code> no nome do filtro é o nome da tela da página administrativo que você alterará. Você pode achar uma lista com os nomes dessas telas na página do Codex: "<a href="http://codex.wordpress.org/Plugin_API/Admin_Screen_Reference">Referência de Telas Administrativo @ Plugin API</a>".[/tip]</p>

<h2>Fim da Parte Quatro</h2>

<p>Acabamos de passar pelo quarto conjunto dos 50 filtros, nesse artigo. Espero que você tenha curtido e aprendido coisas novas. Espero que você tenha gostado e aprendido coisas novas. Vejo você no próximo artigo!</p>

<p>Gostaria de saber o que vocês têm achado desta série. Tem gostado dos filtros selecionados? Deixe seus comentários, logo abaixo. E, caso tenha curtido o artigo, não esqueça de compartilhá-lo!</p>