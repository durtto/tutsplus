<title>cms-21296_translation_source</title></head><body><h1>50 Filtros Para WordPress: Filtros 11 a 20</h1>

<p>Na parte anterior dessa série, começamos a falar sobre os 50 filtros para WordPress. Selecionados entre as centenas que existem, começamos resenhando 10 deles.</p>

<p>Nesse tutorial, resenharemos outra leva desses filtros e também apresentaremos alguns exemplos de cada um deles.</p>

<p>É hora de começar!</p>

<h2>Brincando com Dados Traduzíveis no WordPress</h2>

<p>Uma das funcionalidades mais legais do WordPress é permitir que cada pedaço de texto seja traduzível. Se seu site estiver em inglês, ele não precisa dessa funcionalidade - ou precisa? </p>

<p>O filtro <code>gettext</code> pode funcionar de uma maneira diferente para você. Vejamos um exemplo interessante.</p>

<h3>Exemplo: Corrija a Gramática de Outros Desenvolvedores!</h3>

<p>Suponha que você tenha encontrado um bom <em>plugin</em> para usar, mas percebeu que o seu criador não escreve muito bem em Inglês, e vê que há texto mal escrito pelo código. Felizmente, cadeias de caracteres são traduzíveis, então você pode substituir esses textos mal escritos usando o filtro <code>gettext</code>. </p>

<p>Vejamos como:</p>

<pre class="brush: php">&lt;?php

add_filter( 'gettext', 'gettext_example', 20, 3 );

function gettext_example( $translated_text, $text, $domain ) {
    switch ( $translated_text ) {
        case 'Endereco de E-meil' :
            $translated_text = __( 'Endereço de E-mail', 'plugin_text_domain' );
            break;
    }
    return $translated_text
}

// Código Fonte de Exemplo: http://speakinginbytes.com/2013/10/gettext-filter-wordpress/

?&gt;</pre>

<h2>Limpando o <em>Slug</em></h2>

<p>O WordPress usa uma função chamada <code>sanitize_title()</code> para limpar os títulos dos <em>artigos</em>, substituindo os espaços por hifens e os tornando no ponto para serem salvos como <em>slug</em>. Com o filtro <code>sanitize_title</code> (sim, o mesmo nome) você pode estender essa função.</p>

<h3>Exemplo: Removendo a Palavra "de" do <em>Slug</em></h3>

<p>Se não quiser que a palavra "de" apareça em seus <em>slugs</em>, você pode removê-la, usando o trecho de código abaixo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'sanitize_title', 'sanitize_title_example' );

function sanitize_title_example( $title ) {
    $title = str_replace( '-de-', '-', $title );
    $title = preg_replace( '/^de-/', '', $title );
    return $title;
}

?&gt;</pre>

<p>Uma solução simples e elegante.</p>

<h2>Configurando Exceções para Texturização de <em>Shotcode</em></h2>

<p>Esse filtro é útil, uma vez que ele permite "especificar quais <em>shortcodes</em> <strong>não</strong> devem passar pela função <code>wptexturize()</code>", como explicado <a href="http://codex.wordpress.org/Plugin_API/Filter_Reference/no_texturize_shortcodes">no Codex</a>.</p>

<h3>Exemplo: Exclua seu <em>Shortcode</em> da Texturização</h3>

<p>Se quiser que algum <em>shortcode</em> que você criou, fora da texturização, use o código abaixo para adicionar o nome do seu <em>shortcode</em> à lista de "não texturização":</p>

<pre class="brush: php">&lt;?php

add_filter( 'no_texturize_shortcodes', 'no_texturize_shortcodes_example' );

function no_texturize_shortcodes_example( $shortcodes ) {
    $shortcodes[] = 'meushortcode';
    return $shortcodes;
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/no_texturize_shortcodes

?&gt;</pre>

<p>Bem fácil, não é?</p>

<h2>Filtrando o Estado de Aprovação de um Comentário</h2>

<p>O WordPress tem suas próprias verificações para comentários (que podem ser bem fáceis para <em>spammers</em>) antes de decidir se um comentário é considerado lixo, mandado para a fila de moderação ou aprovado automaticamente. O filtro <code>pre_comment_approve</code> permite que <em>plugins</em> ajudem nessa decisão.</p>

<h3>Exemplo: Marcando como Lixo os Comentários com Nomes de Autor Muito Grande</h3>

<p>No meu país, Turquia, os <em>spammers</em> de comentários de sites em WordPress usam nomes bem grandes. Algumas vezes, usam a própria URL como nome. </p>

<p>Com o trecho abaixo, você pode eliminar <em>spammers</em> que usem nomes como "<em>Domestic and International Shipping With Extremely Low Prices (Click Here for More Information)</em>", automaticamente:</p>

<pre class="brush: php">&lt;?php

add_filter( 'pre_comment_approved', 'pre_comment_approved_example', 99, 2 );

function pre_comment_approved_example( $approved, $commentdata ) {
    return ( strlen( $commentdata['comment_author'] ) &gt; 75 ) ? 'spam' : $approved;
}

// Código Fonte de Exemplo: https://gist.github.com/norcross/5468979

?&gt;</pre>

<p>Um agradecimento em especial para <a href="http://twitter.com/norcross/" rel="external" target="_blank">Andrew Norcross</a> pela ideia!</p>

<p>Dica extra: Se quiser eliminar esses comentários lixo, usando a URL do autor do comentário, use o filtro 'comment_author_url' ao invés de 'comment_author'. O Andrew Norcross use o filtro da URL na dica original, por falar nisso.</p>

<h2>Configurando a Funcionalidade "Publicar Através do E-mail"</h2>

<p>Você sabia que você pode pulicar em seu site do WordPress através do e-mail? O WordPress oferece essa funcionalidade, que raramente é usada, e que pode ser habilitada ou desabilitada através do filtro <code>enable_post_by_email_configuration</code>.</p>

<h3>Exemplo: Habilitando ou Desabilitando a Funcionalidade "Publicar Através do E-mail"</h3>

<p>Por algum motivo (talvez por segurança), você queira desabilitar essa funcionalidade. E você pode fazê-lo usando apenas esse pequeno trecho de código abaixo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'enable_post_by_email_configuration', '__return_false', 100 );

?&gt;</pre>

<p>Ou, caso use o WordPress Multisite e queira habilitá-la (ela, por padrão, é desabilitada na versão Multisite), você pode usar a função <code>__return_true()</code>:</p>

<pre class="brush: php">&lt;?php

add_filter( 'enable_post_by_email_configuration', '__return_true', 100 );

?&gt;</pre>

<h2>Filtrando os Títulos das Páginas</h2>

<p>A função <code>wp_title()</code> retorna o título das páginas, aqueles títulos que vemos nas abas dos navegadores. E a função <code>wp_title</code> nos permite alterar os títulos.</p>

<h3>Exemplo: Reescrevendo os Títulos das Páginas – <em>A Forma Correta</em></h3>

<p>Um respeitado "guru" do WordPress (e editor aqui no Tuts+ Code), Tom McFarlin<a href="http://tommcfarlin.com/filter-wp-title/">, explica em seu blog</a> como reescrever, apropriadamente, os títulos das páginas, usando a função <code>wp_title()</code> e o filtro de mesmo nome:</p>

<blockquote>
  <p>Uma vez que <code>wp_title</code> é uma função filtrada, isso significa que podemos prover um gancho customizado que nos permita definir um esquema para mostrar nossos títulos, não apenas de forma mais precisa, mas mais corretamente também.</p>
</blockquote>

<pre class="brush: php">&lt;?php

add_filter( 'wp_title', 'wp_title_example', 10, 2 );

function wp_title_example( $title, $sep ) {
    global $paged, $page;

    if ( is_feed() )
        return $title;

    // adiciona o nome do site.
    $title .= get_bloginfo( 'name' );

    // Adicionar a descrição do site para a página inicial/frontal.
    $site_description = get_bloginfo( 'description', 'display' );
    if ( $site_description &amp;&amp; ( is_home() || is_front_page() ) )
        $title = "$title $sep $site_description";

    // Adiciona o número da página, se necessário.
    if ( $paged &gt;= 2 || $page &gt;= 2 )
        $title = sprintf( __( 'Page %s', 'tuts_filter_example' ), max( $paged, $page ) ) . " $sep $title";

    return $title;
}

// Código Fonte de Exemplo: http://tommcfarlin.com/filter-wp-title/

?&gt;</pre>

<p><a href="http://tommcfarlin.com/filter-wp-title/" rel="external" target="_blank">Tenha certeza de verificar o artigo do Tom.</a> Muito obrigado, Tom!</p>

<h2>Processando Comentários Antes de Serem Salvos na Base de Dados</h2>

<p>Se você precisar de qualquer ajuda em alterar os dados dos comentários (o ID do artigo do comentário, o nome do autor, o endereço de e-mail do autor, o site do autor, o tipo de comentário, o ID de usuário caso ele seja um usuário cadastro ou conteúdo do comentário), o filtro <code>preprocess_comment</code> pode ajudar você.</p>

<h3>Exemplo: Abaixe o Volume dos Gritadores</h3>

<p>VOCÊ RECEBE MUITOS COMENTÁRIOS ONDE CADA PALAVRA ESTÁ ESCRITA EM MAIÚSCULO? Em caso afirmativo, você pode torná-los, automaticamente, em minúsculo, usando o trecho de código abaixo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'preprocess_comment', 'preprocess_comment_example' );

function preprocess_comment_example( $commentdata ) {
    if( $commentdata['comment_content'] == strtoupper( $commentdata['comment_content'] ))
        $commentdata['comment_content'] = strtolower( $commentdata['comment_content'] );
    return $commentdata;
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Filter_Reference/preprocess_comment

?&gt;</pre>

<p>Legal, hein?</p>

<h2>Administrando Redirecionamento Após o Login</h2>

<p>Esse pequeno filtro nos permite configurar os redirecionamentos (outros além do painel administrativo) após o processo de <em>login</em>, que podem ser interessantes em alguns casos.</p>

<h3>Exemplo: Redirecionar os Inscritos para Página Inicial</h3>

<p>Se não quiser seus usuários (do tipo "leitores") vejam o painel administrativo após o realizarem <em>login</em>, você pode redirecioná-los para a página inicial do seu site:</p>

<pre class="brush: php">&lt;?php

add_filter( 'login_redirect', 'login_redirect_example', 10, 3 );

function login_redirect_example( $redirect_to, $request, $user ) {
    global $user;
    if ( isset( $user-&gt;roles ) &amp;&amp; is_array( $user-&gt;roles ) ) {
        if ( in_array( 'subscriber', $user-&gt;roles ) ) {
            return home_url();
        } else {
            return $redirect_to;
        }
    }
    return;
}

?&gt;</pre>

<p>Porém, o <a href="http://codex.wordpress.org/Plugin_API/Filter_Reference/login_redirect">Codex no avisa</a> sobre uma coisa: "Tenha certeza de usar o <code>add_filter</code> fora de <code>is_admin()</code>, uma vez que essa função não está disponível quando o filtro é invocado."</p>

<h2>Criando <em>Links</em> de Ação para Seu <em>Plugin</em></h2>

<p>Se você desenvolve <em>plugins</em>, talvez se pergunte como os desenvolvedores fazem para adicionar <em>links</em> abaixo do nome de seus <em>plugins</em>, lá na página de <em>Plugins</em>. Pois bem, eles usam esse filtro.</p>

<h3>Exemplo: Adicionando um <em>Link</em> "Configurações" na Página de Plugins</h3>

<p>Para adicionar <em>links</em> com ações customizadas sob o nome do seu <em>plugin</em>, na lista da página de <em>Plugin</em>, você pode usar essa função e atrelá-la ao filtro</p>

<pre class="brush: php">&lt;?php

add_filter( 'plugin_action_links_' . plugin_basename( __FILE__ ), 'plugin_action_links_example' );

function plugin_action_links_example( $links ) {
    $links[] = '&lt;a href="' . get_admin_url( null, 'options-general.php?page=my_plugin_settings' ) . '"&gt;' . __( 'Configuração' ) . '&lt;/a&gt;';
    return $links;
}

// Código Fonte de Exemplo: https://codex.wordpress.org/Plugin_API/Filter_Reference/plugin_action_links_(plugin_file_name)

?&gt;</pre>

<p>Perceba que usamos a constante <code>__FILE__</code> para atrelar nossa função ao filtro do nome do seu <em>plugin</em>. Bacana, não é?</p>

<p>Use com cuidado: Se abusar dessa técnica para colocar links nessa área, o pessoal lembrará de você como um <em>spammer</em>.</p>

<h2>Filtrando o Conteúdo Dentro do Editor de Artigos</h2>

<p>Alguma vez já quis que o editor de artigos já viesse com algum conteúdo, como um modelo de artigos ou alguma nota para autores? Você pode fazê-lo, graças ao filtro <code>the_editor_content</code>.</p>

<h3>Exemplo: Deixando Lembretes para os Autores</h3>

<p>Nós vamos criar lembretes para nossos autores. Se tiver um passo-a-passo que precise relembrar seus autores, você pode pré-preencher o editor de artigos com algum texto ou HTML, usando o trecho abaixo:</p>

<pre class="brush: php">&lt;?php

add_filter( 'the_editor_content', 'the_editor_content_example' );

function the_editor_content_example( $content ) {
    // Só retorna o conteúdo filtrado, caso esteja vazio
    if ( empty( $content ) ) {
        $template  = 'EI! Não esqueça de...' . "\n\n";
        $template .= '&lt;ul&gt;&lt;li&gt;Digitar boas tags para seu post,&lt;/li&gt;&lt;li&gt;Configurar a data de publicação para 08:00 da manhã de amanhã,&lt;/li&gt;&lt;li&gt;Mudar o slug para algo mais amigável ao SEO,&lt;/li&gt;&lt;li&gt;E de deletar esse texto, hehe.&lt;/li&gt;&lt;/ul&gt;' . "\n\n";
        $template .= 'Tchau!';
        return $template;
    } else
        return $content;
}

// Código Fonte de Exemplo: http://wpfilte.rs/the_editor_content/

?&gt;</pre>

<p>Altere a variável <code>$template</code> de acordo com aquilo que quiser falar para os autores e pronto!</p>

<h2>Fim da Parte Dois</h2>

<p>Nós passamos pela segunda leva dos 50 filtros. Espero que tenha gostado e aprendido novas coisas. Vejo você no próximo artigo!</p>

<p>Também gostaria de saber o que você achou. Que tal esses filtros? Deixe seu comentário abaixo. Se tiver curtido o artigo, não esqueça de compartilhá-lo!</p>