<h1>Get Started Building Your Blog With Parse.js: User Login</h1>

<p>In the last session, you learned how to add data on <a href="https://parse.com/" rel="external" target="_blank">Parse.com</a> and render it on your website. You got familiar with the concept of objects, collections, and views, and created your first class. From this session and moving forward, you will be creating the admin panel of the blog system. </p>

<p>And it all starts with creating a User class and enabling login.</p>

<h2><span class="sectionnum">1.</span> User Class</h2>

<h3>Step 1: Add a User Class</h3>

<p>Parse.com made it extremely easy to add a new User class. Just click "<strong>Add Class</strong>" and choose "<strong>User</strong>" to create it.</p>

<figure class="post_image">
  <img alt="Add a User class" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22605/image/01-add-user-class.png"/>
</figure>

<p>Add a new row for yourself:</p>

<figure class="post_image">
  <img alt="Add a new user" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22605/image/02-add-new-user.png"/>
</figure>

<h3>Step 2: Add Class-Level Access Controls</h3>

<p>Now that you have a user, we can make the application more secure by setting some <a href="https://www.parse.com/docs/data#security-classes" rel="external" target="_blank">class-level access permissions</a>. </p>

<p>Go to your table for blog posts and click on "<strong>Security</strong>":</p>

<figure class="post_image">
  <img alt="Blog security" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22605/image/03-blog-security.png"/>
</figure>

<p>Change the "Add Fields" permission from public to only yourself:</p>

<figure class="post_image">
  <img alt="Set permission" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22605/image/04-permission-add-field.png"/>
</figure>

<p>This will prevent others from adding new fields to the table.</p>

<p>Similarly, go to the User table and limit the "Add Fields" permission to yourself too. </p>

<p>You can set the rest of the class-level permissions according to your needs, but we will leave it for now.</p>

<h2><span class="sectionnum">2.</span> Prepare an Admin Page</h2>

<h3>Step 1: Clean Up the Navigation</h3>

<p>First things first, let's clean up the navigation bar of the HTML template a little bit to make room for the new admin page. Change the <code class="inline">&lt;nav&gt;</code> element to have only two links: <code class="inline">Home</code> and <code class="inline">Admin</code>:</p>

<pre class="brush: html">&lt;nav class="blog-nav"&gt;
&lt;a class="blog-nav-item active" href="index.html"&gt;Home&lt;/a&gt;
    &lt;a class="blog-nav-item" href="admin.html"&gt;Admin&lt;/a&gt;
&lt;/nav&gt;</pre>

<h3>Step 2: Prepare admin.html and Its CSS</h3>

<p>Then, duplicate <code class="inline">index.html</code> and rename it <code class="inline">admin.html</code>, and duplicate <code class="inline">blog.js</code> and rename it <code class="inline">admin.js</code>. (For those who are familiar with the concept of a router and hate duplicated code, please bear with me for a while. I promise you will eventually learn how to use a router and clean stuff up!)</p>

<p>In <code class="inline">admin.html</code>, apply the <code class="inline">.active</code> class to the correct tab:</p>

<pre class="brush: html">&lt;nav class="blog-nav"&gt;
&lt;a class="blog-nav-item" href="index.html"&gt;Home&lt;/a&gt;
    &lt;a class="blog-nav-item active" href="admin.html"&gt;Admin&lt;/a&gt;
&lt;/nav&gt;</pre>

<p>And link to <code class="inline">admin.js</code> instead of <code class="inline">blog.js</code>:</p>

<pre class="brush: html">&lt;script src="js/admin.js"&gt;&lt;/script&gt;</pre>

<p>Make sure everything's still working well, and we can now move on to quickly throw together some HTML for a login page.</p>

<p>Same old trick, go to <a href="http://getbootstrap.com/examples/signin" rel="external" target="_blank">http://getbootstrap.com/examples/signin</a>, and copy the HTML of <code class="inline">.form-signin</code> into <code class="inline">.main-container</code>.</p>

<pre class="brush: html">&lt;div class="main-container"&gt;
	&lt;form class="form-signin" role="form"&gt;
		&lt;h2 class="form-signin-heading"&gt;Please sign in&lt;/h2&gt;
		&lt;input type="email" class="form-control" placeholder="Email address" required="" autofocus=""&gt;
		&lt;input type="password" class="form-control" placeholder="Password" required=""&gt;
		&lt;div class="checkbox"&gt;
			&lt;label&gt;
				&lt;input type="checkbox" value="remember-me"&gt; Remember me
			&lt;/label&gt;
		&lt;/div&gt;
		&lt;button class="btn btn-lg btn-primary btn-block" type="submit"&gt;Sign in&lt;/button&gt;
	&lt;/form&gt;
&lt;/div&gt;</pre>

<p>Get the style in <code class="inline">signin.css</code>, and copy it into our <code class="inline">blog.css</code>, except for the style of <code class="inline">body</code>:</p>

<pre class="brush: css">.form-signin {
max-width: 330px;
	padding: 15px;
	margin: 0 auto;
}
.form-signin .form-signin-heading,
.form-signin .checkbox {
	margin-bottom: 10px;
}
.form-signin .checkbox {
	font-weight: normal;
}
.form-signin .form-control {
	position: relative;
	height: auto;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
	padding: 10px;
	font-size: 16px;
}
.form-signin .form-control:focus {
	z-index: 2;
}
.form-signin input[type="email"] {
	margin-bottom: -1px;
	border-bottom-right-radius: 0;
	border-bottom-left-radius: 0;
}
.form-signin input[type="password"] {
	margin-bottom: 10px;
	border-top-left-radius: 0;
	border-top-right-radius: 0;
}</pre>

<h3>Step 4: Clean Up admin.js</h3>

<p>Finally, get rid of everything in <code class="inline">admin.js</code> below <code class="inline">Parse.initialize()</code>:</p>

<pre class="brush: javascript">$(function() {

Parse.$ = jQuery;

    // Replace this line with the one on your Quickstart Guide Page
    Parse.initialize("HC87tn6aA7c3sYx9X0vwwLVXeqHDRMYYmrUBK5zv", "3piNGGnRMhvWo8u9pKD9TDc1MJlWhlvK78Vr3fHo");

});</pre>

<p>Now refresh the page:</p>

<figure class="post_image">
  <img alt="Login page" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22605/image/08-login-page.png"/>
</figure>

<p>Looking good! </p>

<h3>Step 5: Tweaking the Login Form</h3>

<p>Some final tweaks to the page: we will be using username to log in, so change the email field to a text field, and add the <code class="inline">name</code> attribute to both input fields:</p>

<pre class="brush: html">&lt;input type="text" name="username" class="form-control" placeholder="Username" required="" autofocus=""&gt;
&lt;input type="password" name="password" class="form-control" placeholder="Password" required=""&gt;</pre>

<p>Change the CSS selector from <code class="inline">email</code> to <code class="inline">text</code> accordingly:</p>

<pre class="brush: css">.form-signin input[type="text"] {
margin-bottom: -1px;
    border-bottom-right-radius: 0;
    border-bottom-left-radius: 0;
}</pre>

<p>And get rid of the "Remember me" checkbox, because we are not planning to get into that in this tutorial.</p>

<h2><span class="sectionnum">3.</span> Enable Login</h2>

<p>Now we are finally ready to enable login. Let's write a bare-bones JavaScript function to log users in when they click on <strong>Submit</strong> in <code class="inline">admin.js</code>:</p>

<pre class="brush: javascript">$('.form-signin').on('submit', function(e) {

// Prevent Default Submit Event
    e.preventDefault();

    // Get data from the form and put them into variables
    var data = $(this).serializeArray(),
        username = data[0].value,
        password = data[1].value;

    // Call Parse Login function with those variables
    Parse.User.logIn(username, password, {
        // If the username and password matches
        success: function(user) {
            alert('Welcome!');
        },
        // If there is an error
        error: function(user, error) {
            console.log(error);
        }
    });

});</pre>

<p>Let's give it a try...</p>

<figure class="post_image">
  <img alt="Login success" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22605/image/09-login-success.png"/>
</figure>

<p>As simple as that: you are now logged in!</p>

<h2><span class="sectionnum">4.</span> Login View and Welcome View</h2>

<p>After you've logged in, you certainly don't want to just see an alert message and stay on the login page. We need to make a welcome screen for the logged-in users.</p>

<p>To do that gracefully, we will make both a login and welcome page in Views and serve them with Parse.js.</p>

<h3>Step 1:  Make Templates</h3>

<p>Just as we did with the blog templates, let's take out everything in <code class="inline">.main-container</code> and make templates for the login page and the welcome page:</p>

<pre class="brush: html">&lt;script id="login-tpl" type="text/x-handlebars-template"&gt;
&lt;form class="form-signin" role="form"&gt;
        &lt;h2 class="form-signin-heading"&gt;Please sign in&lt;/h2&gt;
        &lt;input type="text" name="username" class="form-control" placeholder="Username" required="" autofocus=""&gt;
        &lt;input type="password" name="password" class="form-control" placeholder="Password" required=""&gt;
        &lt;button class="btn btn-lg btn-primary btn-block" type="submit"&gt;Sign in&lt;/button&gt;
    &lt;/form&gt;
&lt;/script&gt;

&lt;script id="welcome-tpl" type="text/x-handlebars-template"&gt;
    &lt;h2&gt;Welcome, {{username}}!&lt;/h2&gt;
&lt;/script&gt;</pre>

<p>We can keep the welcome view very simple for now. It will just take the user object and display the username.</p>

<h3>Step 2: Define Views</h3>

<p>Let's define those views in <code class="inline">admin.js</code>. Notice that because <code class="inline">LoginView</code> doesn't need to render any object, the render function just puts the template HTML to the DOM.</p>

<pre class="brush: javascript">var LoginView = Parse.View.extend({
	template: Handlebars.compile($('#login-tpl').html()),
		render: function(){
			this.$el.html(this.template());
		}
	}),
	WelcomeView = Parse.View.extend({
		template: Handlebars.compile($('#welcome-tpl').html()),
		render: function(){
			var attributes = this.model.toJSON();
			this.$el.html(this.template(attributes));
		}
	});</pre>

<h3>Step 3: Add Login Event to the View</h3>

<p>Remember the simple Login function we have? Now you can make that an event under <code class="inline">LoginView</code>:</p>

<pre class="brush: javascript">var LoginView = Parse.View.extend({
template: Handlebars.compile($('#login-tpl').html()),
    events: {
        'submit .form-signin': 'login'
    },
    login: function(e) {

        // Prevent Default Submit Event
        e.preventDefault();

        // Get data from the form and put them into variables
        var data = $(e.target).serializeArray(),
            username = data[0].value,
            password = data[1].value;

        // Call Parse Login function with those variables
        Parse.User.logIn(username, password, {
            // If the username and password matches
            success: function(user) {
                alert('Welcome!');
            },
            // If there is an error
            error: function(user, error) {
                console.log(error);
            }
        });
    },
        render: function(){
        this.$el.html(this.template());
    }
})</pre>

<p>Notice that we changed <code class="inline">$(this).serializeArray()</code> to <code class="inline">$(e.target).serializeArray()</code>. That's because in this context, <code class="inline">this</code> will point to <code class="inline">LoginView</code>.</p>

<h3>Step 4: Render Login View on the Page</h3>

<p>Before we move on to render the welcome view, let's first render a login view on the actual page and see if it works:</p>

<pre class="brush: javascript">var loginView = new LoginView();
loginView.render();
$('.main-container').html(loginView.el);</pre>

<p>Run it again, and it works just like before.</p>

<h3>Step 5: Render Welcome View in the Success Callback</h3>

<p>Now, let's change the success callback function of <code class="inline">login()</code> to render a welcome view using the returned <code class="inline">user</code> object.</p>

<pre class="brush: javascript">success: function(user) {
var welcomeView = new WelcomeView({ model: user });
    welcomeView.render();
    $('.main-container').html(welcomeView.el);
}</pre>

<p>Test again:</p>

<figure class="post_image">
  <img alt="Welcome screen" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/435/posts/22605/image/10-welcome-screen.png"/>
</figure>

<p>And yay, it surely works!</p>

<h2>Conclusion</h2>

<p>In this session, you've created your second Class: the User Class. You've also created two important views: LoginView and WelcomeView. You also enabled user login on your website, and now you can send a personal welcome message to your users.</p>

<p>This is just the starting point of building a blog admin panel. Stay tuned, and in the next tutorial we will create a new view and enable the "Add a new blog" function.</p>