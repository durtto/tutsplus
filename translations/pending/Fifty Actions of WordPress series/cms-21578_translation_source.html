<h1>50 Ações Para WordPress – 50 Exemplos (1 a 10)</h1>

<p><a href="https://code.tutsplus.com/tutorials/fifty-actions-of-wordpress-an-introduction--cms-21577" rel="external" target="_blank">A parte anterior</a> de nossa série foi a "introdução" ao mundo das ações do WordPress. Neste tutorial, começaremos a revisar as 50 ações selecionadas, explicando o que elas fazem e apresentando um exemplo de cada ação.</p>

<p>Então, sem mais delongas, eis o primeiro conjunto de nossas 50 ações!</p>

<h2>Manipulando a Inicialização do WordPress</h2>

<p>Para resumir, esta ação é ativada logo após tudo estar pronto, com exceção dos cabeçalhos. E é por isso que ela talvez seja a ação mais popular do WordPress, de todos os tempos – uma vez que você pode atrelar praticamente qualquer coisa a ela.</p>

<h3>Alterando Algumas Regras de Reescrita</h3>

<p>Como usuário turco, considero estranho (e um tanto frustrante) que o WordPress não nos permita alterar as URLs base para páginas dos autores, resultados das buscas ou paginações de arquivos de artigos no painel administrativo.</p>

<p>O trecho de código abaixo, contudo, ajuda com esse problema:</p>

<pre class="brush: php">&lt;?php

add_action( 'init', 'init_example' );

function init_example() {
global $wp_rewrite;
    $wp_rewrite-&gt;author_base = 'perfil';
    $wp_rewrite-&gt;search_base = 'busca';
    $wp_rewrite-&gt;pagination_base = 'p';
}

?&gt;</pre>

<p>Legal, hein? (Claro, substitui as palavras em turco por 'perfil', 'busca' e 'p' para ficar claro.)</p>

<h2>Enviando Cabeçalhos HTTP</h2>

<p>Isso não precisa de uma apresentação, uma vez que o nome é autoexplicativo: Essa pequena e útil ação permite-nos configurar os cabeçalhos HTTP a serem enviados!</p>

<h3>Faça o Internet Explorer Usar o Motor de Renderização Mais Atual</h3>

<p>A <em>meta tag</em> <code>X-UA-Compatible</code> faz com que o Internet Explorer use o motor de renderização especificado para aquela página. Se você configurar para <code>"edge"</code>, o Internet Explorer usará o motor mais atual; contudo, ele falha a validação do HTML se usado em conjunto do <em>Google Chrome Frame</em>.</p>

<p>Por sorte, não estamos limitados ao uso das <em>tag</em> <code>&lt;meta&gt;</code>: Podemos usar cabeçalhos HTTP também. E a ação <code>send_headers</code> é perfeita para essa situação:</p>

<pre class="brush: php">&lt;?php

add_action( 'send_headers', 'send_headers_example' );

function send_headers_example() {
	header( 'X-UA-Compatible: IE=edge,chrome=1' );
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Action_Reference/send_headers

?&gt;</pre>

<h2>Trocando Temas</h2>

<p>Se quiser executar alguma coisa após trocar de temas no WordPress, você pode contar com a ação <code>after_switch_theme</code>.</p>

<h3>Recarregar as Regras de Reescrita Após a Troca de Temas</h3>

<p>Faremos uma ação bem fácil: Como recarregar as regras de reescrita após trocar para um novo tema, já que o novo tema tem novos tipos customizados de artigos? </p>

<p>Pois bem, use o trecho de código abaixo:</p>

<pre class="brush: php">&lt;?php

add_action( 'after_switch_theme', 'after_switch_theme_example' );

function after_switch_theme_example() {
	flush_rewrite_rules();
}

// Código Fonte de Exemplo: http://wpdevsnippets.com/flush-rewrite-rules/

?&gt;</pre>

<p>Bem fácil, hein? </p>

<p>Por algum motivo, não fui capaz de fazê-la funcionar atrelando a função <code>flush_rewrite_rules()</code> à ação <code>after_switch_theme</code> e não consegui descobrir o porque – se souber o motivo, mostre-nos nos comentários.</p>

<h2>Adicionando Colunas Customizadas à Lista de <em>Posts</em></h2>

<p>Essa pequena ação permite-nos criar colunas adicionais à lista de <em>posts</em> na página administrativa "Todos os Posts".</p>

<h3>Mostrando a Quantidade de Anexos em uma Coluna</h3>

<p>Imagine que você precisa saber a quantidade de arquivos anexados a cada um dos seus <em>posts</em>, porque, digamos, você quer ter certeza que a galeria de imagens tem, exatamente, 10 fotos em todos e cada um dos artigos. Ao invés de verificar manualmente a quantidade em cada um deles, você pode adicionar essa coluna extra na página de "Todos os Posts", dessa forma:</p>

<pre class="brush: php">&lt;?php

add_filter( 'manage_posts_columns', 'manage_posts_columns_example', 5 );
add_action( 'manage_posts_custom_column', 'manage_posts_custom_column_example', 5, 2 );

function manage_posts_columns_example( $columns ) {
	$columns['post_attachments'] = __( 'Anexos', 'theme-name' );
	return $columns;
}

function manage_posts_custom_column_example( $column_name, $post_id ) {
	if( 'post_attachments' == $column_name ) {
		$attachments = get_children( array( 'post_parent' =&gt; $post_id ) );
		$count = count( $attachments );
		if( $count != 0 ) {
			echo $count;
    }
	}
}

// Código Fonte de Exemplo: http://wpsnipp.com/index.php/functions-php/display-post-attachment-count-in-admin-column/

?&gt;</pre>

<p>Claramente, esse é um exemplo para um cenário muito específico. Mas, lembre-se que ele existe e viu aqui no Tuts+ Code – você nunca saber quando precisará!</p>

<h2>Trabalhando com a <em>Tag</em> <code>&lt;head&gt;</code> das Páginas Administrativas</h2>

<p>De tempos em tempos, talvez precisemos injetar algumas coisas nos cabeçalhos <code>&lt;head&gt;</code> das páginas de nossos painéis administrativos. E a ação <code>admin_head</code> faz exatamente isso!</p>

<h3>Apresentando um <em>Favicon</em> Diferente no Painel Administrativo</h3>

<p>Esse exemplo simples e rápido demonstra como injetar o código HTML necessário para um "favicon" próprio para o <code>&lt;head&gt;</code> do seu painel administrativo, com facilidade:</p>

<pre class="brush: php">&lt;?php

add_action( 'admin_head', 'admin_head_example' );

function admin_head_example() {
	echo '&lt;link rel="shortcut icon" type="image/x-icon" href="' . get_bloginfo('template_directory') . '/images/admin-favicon.ico" /&gt;';
}

// Código Fonte de Exemplo: http://wpdevsnippets.com/wp-admin-custom-favicon/

?&gt;</pre>

<p>Coloque o arquivo <code>admin-favicon.ico</code> dentro do diretório <code>/images/</code> do seu tema e pronto!</p>

<h2>Injetando Código na Função <code>wp_footer()</code></h2>

<p>Essa ação é chamada quando a função de mesmo nome, <code>wp_footer()</code>, é executada. Você pode usá-la para customizar o retorno dessa função.</p>

<h3>Apresentando um Relatório de Performance para o Administradores</h3>

<p>Quer um relatório rápido sobre quantas consultas suas páginas executam e quanto de memória elas usam? Esse pequeno trecho de código ajudará:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_footer', 'wp_footer_example' );

function wp_footer_example() {
$stat = sprintf( '%d consultas em %.3f segundos, usando %.2fMB de memória',
		get_num_queries(),
		timer_stop( 0, 3 ),
		memory_get_peak_usage() / 1024 / 1024
	);
    if( current_user_can( 'manage_options' ) ) {
		echo "&lt;!-- {$stat} --&gt;";
    }
}

// Código Fonte de Exemplo: http://wordpress.stackexchange.com/a/1866

?&gt;</pre>

<p>Agora, você verá um trecho de informação comentado sobre suas consultas, no código fonte de suas páginas. Não se preocupe, usuários não administradores não verão isso.</p>

<h2>Lidando com o Enfileiramento de <em>Scripts</em> do <em>Frontend</em></h2>

<p>Essa é uma das ações que o conhecimento é fundamental para quem trabalha com temas: A ação <code>wp_enqueue_scripts</code> lida com o processo de enfileiramento de <em>scripts</em> e estilos do <em>frontend</em>.</p>

<h3>O Uso Correto da Função <code>wp_enqueue_script()</code></h3>

<p>Há inúmeras formas de enfileirar <em>scripts</em> e estilos do <em>frontend</em>, mas só há uma forma correta de fazê-lo dentro do WordPress:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_enqueue_scripts', 'wp_enqueue_scripts_example' );

function wp_enqueue_scripts_example() {
	// você pode enfileirar scripts...
	wp_enqueue_script( 'meu-script', get_stylesheet_directory_uri() . '/scripts/meu-script.js' );
	// ...e estilos também!
	wp_enqueue_style( 'meu-estilo', get_stylesheet_directory_uri() . '/styles/meu-estilo.css' );
}

?&gt;</pre>

<h2>Criando Avisos para Páginas Administrativas</h2>

<p>A ação <code>admin_notices</code> é responsável por todos os avisos, erros e mensagens apresentadas no cabeçalho das páginas administrativas. Você pode usá-la para mostrar suas próprias mensagens também.</p>

<h3>Avisando Usuários Conectados Sobre Manutenção do Site</h3>

<p>Digamos que você está mudando de servidor e quer avisar aos autores sobre a situação: Eles não devem postar qualquer coisa! Você pode bloquear o painel administrativo para os não administradores, ou pode, simplesmente, deixar uma mensagem de aviso, como essa:</p>

<pre class="brush: php">&lt;?php

add_action( 'admin_notices', 'admin_notices_example' );

function admin_notices_example() {
	echo '&lt;div class="error"&gt;
			&lt;p&gt;Estamos em um período de manutenção. Por favor, não realize qualquer alterações ou crie quaisquer posts até confirmação do fim da manutenção!&lt;/p&gt;
		  &lt;/div&gt;';
}

// Código Fonte de Exemplo: http://wpsnippy.com/show-notification-message-wordpress-admin-pages/

?&gt;</pre>

<p>Usamos a classe CSS "error", aqui. Se quiser uma borda verde (que se assemelha mais a uma mensagem de "sucesso"), você pode usar a classe CSS "updated".</p>

<h2>Manipulando a Inicialização de <em>Widgets</em></h2>

<p>Os <em>widgets</em> do WordPress são um sistema excelente que permite a nós, desenvolvedores, criarmos e editar partes de nossos sites. E a ação <code>widgets_init</code> permite-nos modificar o comportamento de <em>widgets</em> se necessário.</p>

<h3>Prevenindo o Carregamento dos <em>Widgets</em> Padrão do WordPress</h3>

<p>Por algum motivo, talvez você queira desabilitar os <em>widgets</em> padrão do WordPress de uma só vez. Se for o caso, o trecho de código abaixo ajudará a removê-los completamente da sua instalação WordPress:</p>

<pre class="brush: php">&lt;?php

add_action( 'widgets_init', 'widgets_init_example' );

function widgets_init_example() {
	unregister_widget( 'WP_Widget_Pages' );
	unregister_widget( 'WP_Widget_Calendar' );
	unregister_widget( 'WP_Widget_Archives' );
	unregister_widget( 'WP_Widget_Links' );
	unregister_widget( 'WP_Widget_Meta' );
	unregister_widget( 'WP_Widget_Search' );
	unregister_widget( 'WP_Widget_Text' );
	unregister_widget( 'WP_Widget_Categories' );
	unregister_widget( 'WP_Widget_Recent_Posts' );
	unregister_widget( 'WP_Widget_Recent_Comments' );
	unregister_widget( 'WP_Widget_RSS' );
	unregister_widget( 'WP_Widget_Tag_Cloud' );
}

?&gt;</pre>

<p>Claro, você pode comentar ou remover as linhas dos <em>widgets</em> que você ainda quer que sejam carregados.</p>

<h2>Removendo Usuários do WordPress</h2>

<p>Precisa que algo seja feito toda vez que um usuário é removido? A ação <code>delete_user</code> é seu amigo: Ela será acionada após um usuário ser removido.</p>

<h3>Enviando um E-mail para o Usuário Após a Conta Ser Removida</h3>

<p>Se você tem um site que, ocasionalmente, atrai pessoas ruins e precisa remover alguns usuários frequentemente, talvez queira considerar avisá-los da remoção de suas contas. O trecho de código abaixo fará isso:</p>

<pre class="brush: php">&lt;?php

add_action( 'delete_user', 'delete_user_example' );

function delete_user_example( $user_id ) {
	global $wpdb;
	$user_obj = get_userdata( $user_id );
	$email = $user_obj-&gt;user_email;
	$headers = 'From: ' . get_bloginfo( 'name' ) . ' &lt;' . get_bloginfo( 'admin_email' ) . '&gt;' . "\r\n";
	$subject = 'Você foi removido';
	$message = 'Sua conta no site ' . get_bloginfo( 'name' ) . ' foi removida por seu comportamento abusivo.';
	wp_mail( $email, $subject, $message, $headers );
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Action_Reference/delete_user

?&gt;</pre>

<p>Se quiser, pode alterar os valores das variáveis <code>$subject</code> e <code>$message</code> com uma mensagem um pouco mais <em>formal</em>.</p>

<h2>Resumo de Hoje</h2>

<p>Passamos pelas primeiras 10 ações, do total de 50, neste artigo. Espero que tenha gostado e aprendido novas coisas. Vejo você no próximo!</p>

<p>Gostaria de saber o que vocês têm achado desta série. Tem gostado das ações selecionadas? Deixe seus comentários, logo abaixo. E, caso tenha curtido o artigo, não esqueça de compartilhá-lo!</p>