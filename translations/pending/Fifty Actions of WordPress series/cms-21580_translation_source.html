<h1>50 Ações Para WordPress – 50 Exemplos (21 a 30)</h1>

<p>Nesta série, estamos vendo as ações para WordPress: Um tipo de gancho que a aplicação oferece e que nos permite customizar sua execução. No <a href="https://code.tutsplus.com/tutorials/fifty-actions-of-wordpress-50-examples-11-to-20--cms-21579" rel="external" target="_blank">artigo anterior</a>, vimos o segundo conjunto de ações, chegando a um total de 20 ações vistas, até agora.</p>

<p>Mantendo a tradução dos artigos anteriores, veremos outras 10 ações, bem como um exemplo para cada uma delas. </p>

<p>Dito isso, continuemos.</p>

<p>Manipulando <code>get_posts()</code> Antes Dela Ser Processada</p>

<p>A ação <code>pre_get_posts</code> lida com uma das funções de consulta mais importantes: <code>get_posts()</code>.</p>

<h3>Incluindo Tipos de Postagens Customizados Nos Resultados das Buscas</h3>

<p>Digamos que você mantenha um blog de resenhas de filmes e precisa que o tipo de postagem "Filmes", apareça no resultado das buscas. Você pode incluir qualquer tipo de postagem que quiser, com a ajuda do seguinte trecho de código:</p>

<pre class="brush: php">&lt;?php

add_action( 'pre_get_posts', 'pre_get_posts_example' );
function pre_get_posts_example( $query ) {

	if ( ! is_admin() &amp;&amp; $query-&gt;is_main_query() ) {

		if ( $query-&gt;is_search ) {
			$query-&gt;set( 'post_type', array( 'post', 'filme' ) );
        }

    }
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Action_Reference/pre_get_posts
?&gt;</pre>

<p>Voilà! Agora, os resultados das buscas em seu site incluirão o tipo de postagem "filmes" além das postagens tradicionais.</p>

<h2>Lidando com Alterações de Estado das Postagens</h2>

<p>Há inúmeras ações para transições de estado das pastagens – <code>draft_to_publish</code>, <code>new_to_future</code>, <code>publish_to_private</code> e por aí vai. O une esse conjunto de ações e <a href="http://codex.wordpress.org/Post_Status_Transitions">o chama de <code>{$old_status}_to_{$new_status}</code> no Codex</a>.</p>

<p>Mas, caso queira uma ação que observe todas as alterações de estado, é possível usar a ação <code>transition_post_status</code>.</p>

<h3>Enviando E-mails Para o Administrado Toda Vez Quem O Estado de Uma Postagem For Alterado</h3>

<p>Imagine que você mantém um blog com vários autores e três editores, e precisa de informação sobre cada alteração de estado de cada postagem. Se esse for o caso, você pode usar o trecho de código abaixo:</p>

<pre class="brush: php">&lt;?php

add_action( 'transition_post_status', 'transition_post_status_example', 10, 3 );
function transition_post_status_example( $new_status, $old_status, $post ) {

if( $post-&gt;post_type !== 'post' ) {
        return;
    }

	$title		= $post-&gt;post_title;
	$to			= get_option( 'admin_email' );
	$subject	= 'Estado de postagem alterado';
	$body		= "Ei,\n\nO estado da postagem \"$title\" mudou de \"$old_status\" para \"$new_status\".\n\nAté logo!";

	wp_mail( $to, $subject, $body );
}

?&gt;</pre>

<h2>Enfileirando <em>Scripts</em> Nas Páginas Administrativas</h2>

<p>Se você já precisou injetar algum arquivo JavaScript no painel administrativo de algum site, a ação <code>admin_enqueue_scripts</code> foi feita para você: Essa pequena ação é responsável pelo enfileiramento de <em>scripts</em> (e estilos) dentro do painel do WordPress.</p>

<h3>Injetando um <em>Script</em> Para As Telas de Adicionar/Editar Postagens</h3>

<p>Digamos que você criou uma <em>meta box</em> especial, mas precisa de um arquivo JavaScript para fazer com ela funcione. O que fazer? Você não imprimirá uma <em>tag</em> <code>&lt;script&gt;</code> em seu código – você usa o trecho abaixo!</p>

<pre class="brush: php">&lt;?php

add_action( 'admin_enqueue_scripts', 'admin_enqueue_scripts_example' );
function admin_enqueue_scripts_example( $hook ) {

	if( 'edit.php' != $hook ) {
		return;
}

	wp_enqueue_script( 'meu_script_customizado', plugin_dir_url( __FILE__ ) . 'meuscript.js' );
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Action_Reference/admin_enqueue_scripts

?&gt;</pre>

<h2>Controlando o Processo de Salvamento de Postagens</h2>

<p>Como o nome sugere, essa ação útil é invocada quando uma postagem é salva no banco de dados.</p>

<h3>Requerendo uma Imagem Destacada Antes de Publicar ou Agendar alguma Postagem</h3>

<p>Algumas vezes, esqueço de configurar uma imagem customizada para suas postagens, embora todos as minhas postagens devessem ter uma. Enquanto buscava uma solução para meu problema, deparei-me com essa resposta elegante:</p>

<pre class="brush: php">&lt;?php

add_action( 'save_post', 'save_post_example' );
add_action( 'admin_notices', 'admin_notices_example' );
function save_post_example( $post_id ) {

	// mude para qualquer postagem customizada
	if( get_post_type( $post_id ) != 'post' ) {
    return;
    }

	if ( ! has_post_thumbnail( $post_id ) ) {

		// Configura uma mensagem momentânea para mostrar ao usuários
    // na página administrativa
		set_transient( 'has_post_thumbnail', 'no' );

		// Desatrele essa função para que ela não execute infinitamente
		remove_action( 'save_post', 'wpds_check_thumbnail' );

		// Atualize a postagem e configure-o como rascunho
		wp_update_post( array( 'ID' =&gt; $post_id, 'post_status' =&gt; 'draft' ) );
		add_action( 'save_post', 'wpds_check_thumbnail' );

	} else {
        delete_transient( 'has_post_thumbnail' );
    }

}

function admin_notices_example() {

	// verifica se a mensagem momentânea está configurada e mostre a
  // mensagem de erro
	if ( get_transient( 'has_post_thumbnail' ) == 'no' ) {
		echo '&lt;div id="message" class="error"&gt;&lt;p&gt;Você deve selecionar uma imagem destacada para sua postagem.&lt;/p&gt;&lt;/div&gt;';
		delete_transient( 'has_post_thumbnail' );
    }

}

// Código Fonte de Exemplo: http://wpdevsnippets.com/require-post-thumbnail-uploaded-before-publishing/

?&gt;</pre>

<p>Um exemplo longo, mas muito bacana, não é?</p>

<h2>Adicionando <em>Meta Boxes</em> para Tipos de Postagens</h2>

<p><em>Meta boxes</em> são um dos principais motivos do WordPress ser um dos sistemas gerenciadores de conteúdo mais flexíveis do mundo. É verdade: Você pode criar praticamente qualquer coisa como uma <em>meta box</em>, permitindo que seus usuários criem dados para postagens nelas. E a ação <code>add_meta_boxes</code> é o gancho principal que usamos para criar <em>meta boxes</em>.</p>

<h3>Criando uma <em>Meta Box</em> Simples</h3>

<p>Estamos falando sobre ações e não quero fugir do tópico, por isso, apenas mostrarei como essa ação é usada: Criando uma ação que tenha uma ou mais funções <code>add_meta_box()</code> e atrelando à ação <code>add_meta_boxes</code>:</p>

<pre class="brush: php">&lt;?php

// ação para o tipo de postagem 'post'
add_action( 'add_meta_boxes', 'add_meta_boxes_example', 10, 2 );

// ação para o tipo de postagem 'event'
add_action( 'add_meta_boxes_event', 'add_meta_boxes_example', 10, 2 );

function add_meta_boxes_example( $post_type, $post ) {

add_meta_box(
        'my-meta-box',
        __( 'Minha Meta Box' ),
        'render_my_meta_box',
        'post',
        'normal',
        'default'
    );
}

function render_my_meta_box() {
	// código para criar a meta box
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Action_Reference/add_meta_boxes

?&gt;</pre>

<p>[tip]Se quiser aprender mais sobre a criação de <em>meta boxes</em> customizadas, <a href="http://code.tutsplus.com/tutorials/how-to-create-custom-wordpress-writemeta-boxes--wp-20336">veja esse super tutorial</a> escrito por Christopher Davis.[/tip]</p>

<h2>Brincando com a Seção "Agora"</h2>

<p>A seção "Agora", é o principal <em>widget</em> do painel de cada instalação WordPress. Com a ação <code>activity_box_end</code>, você pode mexer com essa área sem problemas.</p>

<h3>Colocando Suas Informações de Contato Abaixo da Seção "Agora"</h3>

<p>Digamos que você é um desenvolvedor de WordPress Autônomo e quer que seus clientes possam lembrar do seu número de telefone. Com o trecho de código abaixo, você pode deixar um aviso para ele logo abaixo da seção "Agora":</p>

<pre class="brush: php">&lt;?php

add_action( 'activity_box_end', 'activity_box_end_example' );

function activity_box_end_example() {
   _e( "Se tiver quaisquer perguntas ou dúvidas, você pode contatar o desenvolvedor no telefone +55 (86) 8117-4129 (Seg a Sex, das 8h às 18h). Tenha um bom dia!" );
}

?&gt;</pre>

<h2>Alterando o <em>Widget</em> "Meta" Padrão</h2>

<p>O WordPress oferece vários <em>widgets</em> padrão, e o <em>widget</em> "Meta" é um deles. Com a ajuda da ação <code>wp_meta</code> podemos customizá-lo da forma que quisermos.</p>

<h3>Adicionando um <em>Link</em> de "Siga-nos no Twitter" no <em>Widget</em> "Meta"</h3>

<p>Com certeza, o <em>widget</em> "Meta" <strong>não</strong> é o mais popular dos <em>widgets</em> padrão do WordPress. Porém, você pode torná-lo mais funcional e atraente, adicionando algumas linhas de código a mais, com <em>links</em>, como abaixo:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_meta', 'wp_meta_example' );

function wp_meta_example() {

	$twitter_username = 'erickpatrick';
	echo '&lt;li&gt;Siga-nos no Twitter:&lt;a href="https://twitter.com/' . $twitter_username . '"&gt;' . $twitter_username . '&lt;/a&gt;&lt;/li&gt;';

}

?&gt;</pre>

<p>Claro, esse é só um exemplo bem básico, mas que funciona!</p>

<h2>Brincando com o Painel Administrativo</h2>

<p>O "painel" é a parte mais importante da área administrativa de toda instalação do WordPress. Com a ação <code>wp_dashboard_setup</code> você pode customizar o painel da forma que quiser.</p>

<h3>Mostrando os Comentários Mais Recentes do Disqus em um <em>Widget</em> do Painel</h3>

<p>Se você usa o Disqus como seu sistema de comentários (sem o <em>plugin</em> oficial) e quer ver os comentários mais recentes no seu painel, você pode usar o trecho abaixo para adicionar um <em>widget</em> ao seu painel:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_dashboard_setup', 'wp_dashboard_setup_example' );

function wp_dashboard_setup_example() {

	$disqus_username = 'NOME_DE_USUARIO';
	$number_of_comments = 5;

	wp_add_dashboard_widget( 'disqus-feed', 'Últimos Comentários do Disqus', 'acme_display_disqus_comments' );
}

function acme_display_disqus_comments() {
    echo '&lt;div id="recentcomments" class="dsq-widget"&gt;' . '&lt;script src="//' . $disqus_username . '.disqus.com/recent_comments_widget.js?num_items=' . $number_of_comments . '"&gt;&lt;/script&gt;&lt;/div&gt;';
}

?&gt;</pre>

<p>Altere as variáveis <code>$disqus_username</code> e <code>$number_of_comments</code> e você estará pronto!</p>

<h2>Configurando o Usuário Atual</h2>

<p>Veja, uma ação para uma funções plugáveis! O WordPress define "funções plugáveis" assim:</p>

<blockquote>
  <p>Essas funções podem ser substituídas por <em>plugins</em>. Se <em>plugins</em> não redefinirem essas funções, ela serão usadas no lugar.</p>
</blockquote>

<p>E essa pequena e útil ação faz parte da função plugável <code>wp_set_current_user</code> da base do WordPress, que altera o usuário atual através do ID ou nome.</p>

<h3>Removendo a Barra de Ferramentas para Assinantes</h3>

<p>Não alteraremos o usuário agora, mas lançaremos mão dessa ação e verificaremos as capacidades do usuário atual e desabilitar a barra de ferramentas se o usuário for apenas um assinante:</p>

<pre class="brush: php">&lt;?php

add_action( 'set_current_user', 'set_current_user_example' );
function set_current_user_example() {

	if ( ! current_user_can( 'edit_posts' ) ) {
    show_admin_bar( false );
    }

}

?&gt;</pre>

<h2>Carregando <em>Plugins</em></h2>

<p>Se você precisar que alguma coisa seja feita após o WordPress terminar de carregar os <em>plugins</em> ativos, você pode usar a ação <code>plugins_loaded</code>.</p>

<h3>Iniciando seu <em>Plugin</em></h3>

<p>A forma correta de inicia seu plugin e fazê-lo funcionar é através do atrelamento da função principal dele à ação <code>plugins_loaded</code>. Aqui, temos um exemplo bem simples de como fazer isso:</p>

<pre class="brush: php">&lt;?php

add_action( 'plugins_loaded', 'plugins_loaded_example' );
function plugins_loaded_example() {
	add_action( 'wp_footer', 'display_message', 100 );
}

function display_message() {
	echo '&lt;p&gt;Texto fictício!&lt;/p&gt;';
}

// Código Fonte de Exemplo: http://www.scratchinginfo.com/common-wordpress-action-hooks-for-plugin-development/

?&gt;</pre>

<p>Se precisar de um exemplo melhor, e tenho certeza que precisará, <a href="https://github.com/tommcfarlin/WordPress-Plugin-Boilerplate">você quererá verificar o "<em>WordPress Plugin Boilerplate</em>" do Tom McFarlin</a>, que tem tudo que você precisa para construir um <em>plugin</em> do WordPress levando em conta o conceito de programação orientada a objetos.</p>

<h2>Fim da Parte Três</h2>

<p>Passamos pelo terceiro conjunto das 50 ações neste artigo. Espero que tenha gostado e aprendido novas coisas. Vejo você no próximo!</p>

<p>Gostaria de saber o que vocês têm achado desta série. Tem gostado das ações selecionadas? Deixe seus comentários, logo abaixo. E, caso tenha curtido o artigo, não esqueça de compartilhá-lo!</p>