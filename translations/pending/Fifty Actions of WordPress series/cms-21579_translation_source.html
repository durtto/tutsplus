<h1>50 Ações Para WordPress – 50 Exemplos (11 a 20)</h1>

<p><a href="https://code.tutsplus.com/tutorials/fifty-actions-of-wordpress-50-examples-1-to-10--cms-21578" rel="external" target="_blank">No artigo anterior desta série</a>, começamos com as primeiras ações para WordPress, das 50 que apresentaremos. Neste tutorial, veremos outro conjunto de ações, bem como exemplos de cada uma.</p>

<p>É hora de começar!</p>

<h2>Manipulando os Estilos CSS Padrão do WordPress</h2>

<p>O WordPress usa inúmeros arquivos CSS, tanto no <em>backend</em> quanto no <em>frontend</em>. Com a ação <code>wp_default_styles</code> podemos manipular os estilos padrão do WordPress.</p>

<h3>Removendo o Arquivo <code>ie.css</code> do Painel Administrativo do WordPress</h3>

<p>Se você for o único a acessar o painel administrativo de um site em WordPress, provavelmente, não o fará usando o Internet Explorer, logo, não há necessidade de carregar o arquivo CSS próprio para o IE, não é? </p>

<p>Você pode usar o trecho de código abaixo e livrar-se do arquivo <code>ie.css</code>:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_default_styles', 'wp_default_styles_example' );

function wp_default_styles_example( $wp_styles ) {
$wp_styles-&gt;remove( 'ie' );
}

?&gt;</pre>

<p>Para falar a verdade, não acredito que o WordPress ainda precise desse arquivo &mdash; afinal, o arquivo <code>ie.css</code> resolve problemas relacionados ao IE7 ou inferiores e, até onde eu saiba, o seu uso caiu para menos de 1%. </p>

<p>Nós deveríamos <a href="http://code.tutsplus.com/tutorials/creating-and-submitting-a-patch-to-wordpress-core--cms-20658">sugerir uma correção</a>, não é?</p>

<h2>Manipulando a Função <code>get_footer()</code></h2>

<p>Se precisar mexer com a função <code>get_footer()</code>, você não precisa ir muito além &mdash; pode usar a ação homônima, <code>get_footer</code>!</p>

<h3>Injetando JavaScript no Rodapé das Páginas</h3>

<p>Digamos que você tem algum <em>script</em> com jQuery que você precisa que esteja no rodapé de suas páginas. Você pode usar o código abaixo para inseri-lo:</p>

<pre class="brush: php">&lt;?php

add_action( 'get_footer', 'get_footer_example' );

function get_footer_example( $name ) {
	if ( 'new' == $name ) { ?&gt;
		&lt;script&gt;
			(function( $ ) {
				//Coloque todo o seu código jQuery aqui
			})( jQuery );
		&lt;/script&gt;
	&lt;?php
	}
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Action_Reference/get_footer

?&gt;</pre>

<p>Aí está. Usamos um pouco de código JavaScript, mas você pode colocar qualquer código em seu rodapé.</p>

<h2>Inicializando o Painel Administrativo</h2>

<p>Esta útil função é executada toda vez que uma página administrativa é visitada, assim, ela possui diversos uso. Deixe sua criatividade fluir!</p>

<h3>Mantendo Não Administradores Longe do Painel Administrativo</h3>

<p>Digamos que você não quer que os leitores assinantes do seu site sejam capazes de visitar o painel administrativo, ou que você não tem qualquer ajudante, autor ou editor. Para redirecionar todos os usuários não administradores para a página inicial, você pode usar o trecho de código abaixo:</p>

<pre class="brush: php">&lt;?php

add_action( 'admin_init', 'admin_init_example', 1 );

function admin_init_example() {
	if ( ! current_user_can( 'manage_options' ) &amp;&amp; ( ! defined( 'DOING_AJAX' ) || ! DOING_AJAX ) ) {
		wp_redirect( site_url() );
		exit;
	}
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Plugin_API/Action_Reference/admin_init

?&gt;</pre>

<p>Se quiser, pode alterar o endereço de redirecionamento para outro lugar que não seja sua página inicial: Apenas remove a chamada <code>site_url()</code> e digitar o endereço deseja usando aspas simples (assim: <code>'http://www.google.com/'</code>).</p>

<h2>Mexendo no Processo de Autenticação</h2>

<p>A documentação define essa ação com apenas uma frase: "É executada para autenticar um usuário quando ele faz <em>login</em>".</p>

<h3>Permitindo Endereços de E-mail como Nomes de Usuário no Processo de <em>Login</em></h3>

<p>O WordPress não permite que usuários realizem o acesso usando seus endereços de e-mail – você precisa lembrar do seu nome de usuário. Se seus usuários tendem a esquecer os nomes de usuários deles, use o trecho de código abaixo e avise-os que podem acessar o painel administrativo usando seus endereços de e-mail também:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_authenticate', 'wp_authenticate_example' );

function wp_authenticate_example( $username ) {
	$user = get_user_by( 'email', $username );
	if ( ! empty( $user-&gt;user_login ) ) {
		$username = $user-&gt;user_login;
}
	return $username;
}

// Código Fonte de Exemplo: http://bavotasan.com/2011/log-in-to-wordpress-using-an-email-address/

?&gt;</pre>

<p>Agora, os usuários podem usar seus e-mails ao invés dos nomes de usuários.</p>

<h2>Brincando com o Formulário de <em>Login</em></h2>

<p>A ação <code>login_form</code> permite-nos manipular o retorno do formulário de <em>login</em> clássico.</p>

<h3>Mostrando um Aviso no Formulário de <em>Login</em></h3>

<p>No exemplo anterior, mostramos como permitir que os usuários usem seus e-mails ao invés de seus nomes de usuários. Se você não for um fã disso, você pode avisá-los que eles não podem usar seus e-mails, apenas o nome de usuário:</p>

<pre class="brush: php">&lt;?php

add_action( 'login_form', 'login_form_example' );

function login_form_example() {
	echo '&lt;p&gt;&lt;strong&gt;Lembre-se:&lt;/strong&gt; Você deve usar seu nome de usuário, não seu endereço de e-mail!&lt;/p&gt;';
}

?&gt;</pre>

<p>Claro, você pode colocar outros avisos, como "Não selecione a opção 'Manter-me conectado' se estiver em um computador compartilhado!" ou algo engraçado como "Se você estiver na mira de um ladrão ao realizar seu <em>login</em>, digite sua senha de trás para frente e o WordPress chamará a polícia &mdash; mas, se você está lendo isso, quer dizer que o cara mau também está... CORRA!". Você também pode usar HTML.</p>

<h2>Manipulando Itens do Menu Administrativo</h2>

<p>Definida como "executada após a estrutura básica do menu administrativo estiver pronta", a ação <code>admin_menu</code> permite você adicionar ou remover itens do menu (e itens de submenus, também) do menu do painel do WordPress.</p>

<h3>Removendo Itens Que Não Devem Ser Vistos Por Clientes</h3>

<p>É um cenário muito familiar para desenvolvedores autônomos de WordPress: Um cliente precisa ter acesso à certa página de opções de um <em>plugin</em>, mas eles não deveriam tocar em quaisquer outras páginas de opções, principalmente, do a do próprio WordPress. </p>

<p>Em resumo, há página que os clientes podem acessar e há páginas que não devem. O exemplo abaixo removem itens do menu principal do painel administrativo:</p>

<pre class="brush: php">&lt;?php

if ( ! current_user_can( 'manage_options' ) ) {
	add_action( 'admin_menu', 'admin_menu_example' );
}

function admin_menu_example() {
  remove_menu_page( 'index.php' );              //Painel
  remove_menu_page( 'edit.php' );                   //Posts
  remove_menu_page( 'upload.php' );                 //Mídia
  remove_menu_page( 'edit.php?post_type=page' );    //Páginas
  remove_menu_page( 'edit-comments.php' );          //Comentários
  remove_menu_page( 'themes.php' );                 //Aparência
  remove_menu_page( 'plugins.php' );                //Plugins
  remove_menu_page( 'users.php' );                  //Usuários
  remove_menu_page( 'tools.php' );                  //Ferramentas
  remove_menu_page( 'options-general.php' );        //Configurações

}

// Código Fonte de Exemplo: http://wpsnippy.com/remove-top-level-wordpress-dashboard-menu/

?&gt;</pre>

<p>Comente ou remova as linhas dos menus que você deseja manter e pronto!</p>

<h2>Manipulando a Função <code>wp()</code></h2>

<p>Vejamos o que a documentação fala sobre essa ação:</p>

<blockquote>
  <p>"Executa após uma consulta ser analisada e os posts carregados, mas antes da execução de qualquer modelos, dentro da principal função do WordPress wp(). Útil se você precisa ter acesso aos dados dos posts, mas não pode usar modelos para retornos."</p>
</blockquote>

<p>Em resumo, ela é executada logo após a consulta ser carregada. Tão simples quanto o nome.</p>

<h3>Uma Forma Simples de Agendar Tarefas <em>Cron</em> no WordPress</h3>

<p>Embora tarefas <em>cron</em>, geralmente, sejam atreladas a <a href="http://codex.wordpress.org/Function_Reference/register_activation_hook">ganchos de ativação de <em>plugins</em></a>, também podemos usar a ação <code>wp</code> para atrelas nossas tarefas <em>cron</em>. Vejamos o exemplo que o Codex nos dá:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp', 'prefix_setup_schedule' );

/**
 * Em um gancho de ação inicial, verifica se ele está agendado - caso contrário, agende-o.
 */
function prefix_setup_schedule() {
	if ( ! wp_next_scheduled( 'prefix_hourly_event' ) ) {
		wp_schedule_event( time(), 'hourly', 'prefix_hourly_event');
	}
}

add_action( 'prefix_hourly_event', 'prefix_do_this_hourly' );

/**
 * No gancho de ação agendado, execute uma função.
 */
function prefix_do_this_hourly() {
	// faça algo de hora em hora
}

// Código Fonte de Exemplo: http://codex.wordpress.org/Function_Reference/wp_schedule_event

?&gt;</pre>

<p>Perceba que há uma outra função chamada de <code>prefix_hourly_event</code> – essa ação é criada automaticamente no mesmo trecho de código, dentro da função <code>wp_schedule_event()</code>, como terceiro parâmetro.</p>

<h2>Controlando o Elemento <code>&lt;head&gt;</code> das Páginas do Painel Administrativo</h2>

<p>Há vários ganchos (ações <em>e</em> filtros) que possuem "variáveis" em seus nomes. A ação <code>admin_head-(nome_da_pagina)</code> é uma delas, que é chamada no elemento <code>&lt;head&gt;</code> da página especificada na "variável" do nome da ação.</p>

<h3>Alterando Contagem de Colunas no Painel Administrativo</h3>

<p>Eu uso um monitor de 22 polegadas e, desde a versão 3.8 do WordPress sou obrigado a usar um painel com 4 colunas, e isso me deixa doido. Não sei porque não posso definir o número de colunas como era possível anteriormente, mas encontrei uma solução bem simples e rápida, para isso:</p>

<pre class="brush: php">&lt;?php

add_action( 'admin_head-index.php', 'admin_head_index_php_example' );

function admin_head_index_php_example() {
add_screen_option(
        'layout_columns',
        array(
            'max'     =&gt; 3,
            'default' =&gt; 3
        )
    );
}

// Código Fonte de Exemplo: http://wpsnippy.com/bring-back-dashboard-screen-layout-options-wordpress-3-8/

?&gt;</pre>

<p>Agora, posso alterar o número de colunas como antes – desde que minha resolução permita. Ainda não posso escolher mais de 2 colunas no meu notebook, mas acho que posso viver com isso.</p>

<h2>Modificando a Barra de Ferramentas Antes dela Ser Gerada</h2>

<p>A barra de ferramentas do WordPress, também conhecida pelo seu antigo nome, barra administrativa, é um ótimo e útil elemento de navegação que nos ajuda tanto no <em>frontend</em> quanto no <em>backend</em>. A ação <code>wp_before_admin_bar_render</code> ajuda-nos interagir com ela antes de ser gerada.</p>

<h3>Adicionando Novos Itens na Barra de Ferramentas</h3>

<p>Se quiser prover alguns <em>links</em> de acesso rápido para seu clientes contatarem você, use o código abaixo para adiciona-los à barra de ferramentas:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_before_admin_bar_render', 'wp_before_admin_bar_render_example' );

function wp_before_admin_bar_render_example() {
	global $wp_admin_bar;
	$wp_admin_bar-&gt;add_node( array(
		'id'=&gt; 'contact-designer',
		'title' =&gt; 'Contatar Desenvolvedor',
		'href'  =&gt; 'http://erickpatrick.net/contact/',
		'meta'  =&gt; array( 'target' =&gt; '_blank' )
	) );
}

?&gt;</pre>

<p>Bem fácil, certo? Você pode usar a função <code>add_node()</code> outra vez para criar quantos <em>links</em> quiser.</p>

<h2>Processando Atualizações de Perfil</h2>

<p>O gancho <code>profile_update</code> permite-nos buscar e trabalhar com dados do usuário, logo após eles serem atualizados na base de dados.</p>

<h3>Informando o Usuário de Atualização do Perfil</h3>

<p>Digamos que você queira informar ao usuário sobre cada vez que o perfil deles forem atualizados. Com a ajuda dessa útil e pequena ação, podemos fazê-lo:</p>

<pre class="brush: php">&lt;?php

add_action( 'profile_update', 'profile_update_example' );

function profile_update_example( $user_id ) {
	$site_url = get_bloginfo( 'name' );
	$user_info = get_userdata( $user_id );
	$user_name = $user_info-&gt;display_name;
	$user_email = $user_info-&gt;user_email;
	$subject = "Perfil atualizado";
	$message = "Olá, $user_name,\n\nSeu perfil foi atualizado! Por favor, contate-nos se não tiver sido você quem atualizou seu perfil.\n\nObrigado por visitar o $site_name.";
	wp_mail( $user_email, $subject, $message );
}

// Código Fonte de Exemplo: http://wpsnipp.com/index.php/functions-php/send-email-notification-when-profile-updates/

?&gt;</pre>

<p>Na minha opinião, essa é uma medida de segurança bem simples, porém, efetiva. Dito isso, ela não seria efetiva se um <em>hacker</em> em potencial mudar o endereço de e-mail do usuário, uma vez que o e-mail será enviado para o novo endereço de e-mail.</p>

<h2>Fim da Parte Dois</h2>

<p>Neste artigo, passamos pela segunda parte das 50 ações do WordPress. Espero que tenha gostado e aprendido coisas novas. Vejo você no próximo artigo!</p>

<p>Gostaria de saber o que vocês têm achado desta série. Tem gostado das ações selecionadas? Deixe seus comentários, logo abaixo. E, caso tenha curtido o artigo, não esqueça de compartilhá-lo!</p>