<h1>50 Ações Para WordPress – 50 Exemplos (31 a 40)</h1>

<p>Se estiver começando esta série por esse artigo, estamos falando sobre 50 (das inúmeras) ações disponíveis no WordPress. <a href="https://code.tutsplus.com/tutorials/fifty-actions-of-wordpress-50-examples-21-to-30--cms-21580" rel="external" target="_blank">Na última postagem</a>, cobrimos as ações de número 21 até a 30. Assim, manteremos o ritmos com outro conjunto de 10 ações nesse artigo.</p>

<p>Caso não tenha lido os outros, recomendo que volte, leia a <a href="https://code.tutsplus.com/pt/tutorials/fifty-actions-of-wordpress-an-introduction--cms-21577" rel="external" target="_blank">introdução</a> e veja todas as ações pela série de artigos, de modo que você veja tudo que já cobrimos até agora.</p>

<p>Dito isso, é hora de começar!</p>

<h2>Controlando o Código JavaScript Padrão</h2>

<p>O WordPress possui vários <em>scripts</em> em sua base, os quais podemos carregar. A ação <code>wp_default_scripts</code> nos permite interagir com esses arquivos JavaScript.</p>

<h3>Removendo o "jQuery Migrate" de Sites WordPress</h3>

<p>Se você usa alguma código jQuery e tem absoluta certeza que ele é compatível com a versão 1.9 ou posterior, você não precisa do <em>plugin</em> <em>jQuery Migrate</em> que dá suporte a código obsoleto. Eis como pode removê-lo:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_default_scripts', 'wp_default_scripts_example' );
function wp_default_scripts_example( &amp;$scripts ) {

if ( ! is_admin() ) {

        $scripts-&gt;remove( 'jquery' );
        $scripts-&gt;add( 'jquery', false, array( 'jquery-core' ) );

	}

}

// Código Fonte de Exemplo: http://aahacreative.com/2013/08/05/remove-jquery-migrate-wordpress-36/

?&gt;</pre>

<p>Só por precaução, teste todo retorno de arquivos que usem jQuery no seu <em>frontend</em>. Você não quer seu site todo desconfigurado, quer?</p>

<h2>O <code>&lt;head&gt;</code></h2>

<p>Esta ação é ativada na função <code>wp_head()</code> para que você possa inserir alguma coisa no elemento <code>&lt;head&gt;</code> de suas páginas.</p>

<h3>Utilizando o <em>Open Graph</em> em Seu Site</h3>

<p>O <a href="http://ogp.me/">Open Graph</a> é um protocolo bastante importante que ajuda os grandes sites como Facebook, Google e Twitter a entenderem suas páginas. Se você prover informações com o protocolo do <em>Open Graph</em>, você pode definir imagens destacadas, títulos, resumos e muito mais, ajudando-os a construir um conjunto de dados estruturados e válidos para suas páginas.</p>

<p>Vejamos como podemos utilizar esse protocolo e injetar metadados do <em>Open Graph</em> no elemento <code>&lt;head&gt;</code> de nossas páginas:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_head', 'wp_head_example' );

function wp_head_example() {
	global $post;

	// imagem padrão
	$site_logo = get_stylesheet_directory_uri() . '/images/logo.png';

	// página inicial
	if ( is_home() ) {
		echo '&lt;meta property="og:type" content="website" /&gt;';
		echo '&lt;meta property="og:url" content="' . get_bloginfo( 'url' ) . '" /&gt;';
		echo '&lt;meta property="og:title" content="' . esc_attr( get_bloginfo( 'name' ) ) . '" /&gt;';
		echo '&lt;meta property="og:image" content="' . $site_logo . '" /&gt;';
		echo '&lt;meta property="og:description" content="' . esc_attr( get_bloginfo( 'description' ) ) . '" /&gt;';
	}

	// página simples ou publicação/artigo
	elseif ( is_singular() ) {
		echo '&lt;meta property="og:type" content="article" /&gt;';
		echo '&lt;meta property="og:url" content="' . get_permalink() . '" /&gt;';
		echo '&lt;meta property="og:title" content="' . esc_attr( get_the_title() ) . '" /&gt;';
		if ( has_post_thumbnail( $post-&gt;ID ) ) {
			$image = wp_get_attachment_image_src( get_post_thumbnail_id( $post-&gt;ID ), 'large' );
			echo '&lt;meta property="og:image" content="' . esc_attr( $image[0] ) . '" /&gt;';
		} else
			echo '&lt;meta property="og:image" content="' . $site_logo . '" /&gt;';
		echo '&lt;meta property="og:description" content="' . esc_attr( get_the_excerpt() ) . '" /&gt;';
	}
}

// Código Fonte de Exemplo: http://wpdevsnippets.com/set-opengraph-meta-tags-fix-facebook-share/

?&gt;</pre>

<h2>Inicializando o Tema</h2>

<p>Cada vez que os arquivos de um tema são carregados para uma página do WordPress, a ação <code>after_setup_theme</code> é disparada. Uma vez que ela é invocada em cada requisição de páginas, você pode atrelar funções relacionadas ao tema à essa ação.</p>

<h3>Configurando Funcionalidades Específicas do WordPress em Temas</h3>

<p>Há inúmeras formas de habilitar funcionalidades do WordPress para temas, como formatos de publicação ou imagens destacadas, mas a forma correta seria criar uma função para essas funcionalidades e atrelá-la à ação <code>after_setup_theme</code>.</p>

<pre class="brush: php">&lt;?php

add_action( 'after_setup_theme', 'after_setup_theme_example' );

function after_setup_theme_example() {

	add_editor_style();
	add_theme_support( 'post-formats', array( 'video', 'gallery' ) );
	add_theme_support( 'post-thumbnails' );

}

?&gt;</pre>

<p>Agora, nosso tema pode ter imagens destacadas; podemos publicar vídeos e galerias de imagens; e nosso "Editor Visual" pode ter seu próprio arquivo de estilo para parecer mais com o <em>frontend</em> do site.</p>

<h2>Adicionando Colunas Customizadas à Listagem de Mídia</h2>

<p>A ação <code>manage_media_custom_column</code> ajuda-nos a adicionar colunas customizadas à listagem de arquivos enviados na Biblioteca de Mídia.</p>

<h3>Mostrando o ID de Cada Arquivo em uma Coluna</h3>

<p>Eu <em>odeio</em> ter que buscar o ID de uma imagem destacada que precisa ser excluída de uma galeria. Eu realmente odeio. Encontrei esse trecho de código e ele faz com que os IDs dos arquivos enviados apareçam em uma coluna na listagem da Biblioteca de Mídia:</p>

<pre class="brush: php">&lt;?php

add_filter( 'manage_media_columns', 'manage_media_columns_example' );
add_action( 'manage_media_custom_column', 'manage_media_custom_column_example', 10, 2 );

function manage_media_columns_example( $columns ) {
	$columns[ 'wps_post_attachments_id' ] = __( 'ID', 'theme-name' );
	return $columns;
}

function manage_media_custom_column_example( $column_name, $attachment_id ){

	if ( 'wps_post_attachments_id' === $column_name ) {
		echo $attachment_id;
}
}

// Código Fonte de Exemplo: http://wpsnipp.com/index.php/functions-php/media-library-admin-columns-with-attachment-id/

?&gt;</pre>

<p>Espero que você também tenha gostado desse código, porque eu gostei!</p>

<h2>Transições de Situação de Comentários</h2>

<p>Toda vez que a situação de um comentário muda ('aprovado', 'não aprovado', 'spam' ou 'lixeira'), um gancho de ação chamado <code>transition_comment_status</code> será ativado. Após isso, outra ação será invocada com variáveis em seus nomes: <code>comment_(situacao_antiga)_to_(nova_situacao)</code>. Vejamos como a segunda ação funciona.</p>

<h3>Enviando E-mail para o Comentarista Após o Comentário Ser Aprovado</h3>

<p>Suponhamos que você previna que comentários sejam publicados automaticamente sem sua aprovação; suponha também que precisa informar os visitantes sobre a publicação de seus comentários. Você pode enviar um e-mail para eles sobre a publicação do comentário, usando esse pequeno trecho de código, como um <em>plugin</em>:</p>

<pre class="brush: php">&lt;?php

add_action( 'comment_unapproved_to_approved', 'comment_unapproved_to_approved_example' );

function comment_unapproved_to_approved_example( $comment ) {

	$commenter_email = $comment-&gt;comment_author_email;
	$commenter_name  = $comment-&gt;comment_author;
	$post_url = get_comment_link( $comment );
	$subject = "Comentário aprovado!";
	$message = "Olá $commenter_name,\n\nSeu comentário foi aprovado!Você pode vê-lo no link abaixo:\n\n$post_url\n\nObrigado por compartilhar suas ideias conosco!";

wp_mail( $commenter_email, $subject, $message );
}

?&gt;</pre>

<p>Agora, os comentaristas serão informados quando seus comentários forem aprovados. A partir daí, eles podem visitar sua publicação para ver seus comentários e, quem sabe, ler os outros comentários e até outras publicações. Uma forma fácil e fantástica de fazer visitantes retornarem!</p>

<h2>Lidando Com o Carregamento de Modelos de Páginas</h2>

<p>O WordPress usa o que chamamos de "modelos de páginas" para apresentar diferentes tipos de páginas, como uma publicação simples, a página inicial, uma página de erro 404, resultados de buscas, arquivos e coisas do tipo. E a ação <code>template_redirect</code> é executada quando o WordPress decide qual modelo será usado.</p>

<h3>Redirecionando para a Página de uma Publicação Caso a Busca Tenha Um Único Resultado</h3>

<p>Quer facilitar a vida dos seus visitantes? O trecho abaixo ajuda você de uma forma única: se houver apenas um resultado na busca, o usuário verá a página da publicação ao invés da página de resultado da busca. </p>

<p>Um truque bem interessante, se me permite dizer:</p>

<pre class="brush: php">&lt;?php

add_action( 'template_redirect', 'template_redirect_example' );
function template_redirect_example() {

	if ( is_search() ) {

		global $wp_query;

		if ( 1 == $wp_query-&gt;post_count &amp;&amp; 1 == $wp_query-&gt;max_num_pages ) {
			wp_redirect( get_permalink( $wp_query-&gt;posts['0']-&gt;ID ) );
			exit;
		}

	}

}

// Código Fonte de Exemplo: http://www.elegantthemes.com/blog/tips-tricks/eight-useful-code-snippets-for-wordpress

?&gt;</pre>

<p>Agora, se alguém pesquisa por "guacamole" e houver apenas uma publicação mencionando guacamole, o visitante será redirecionado, automaticamente, para aquela publicação. </p>

<p>Legal, hein?</p>

<h2>Lidando com os <em>Feeds</em> do WordPress</h2>

<p>Os <em>feeds</em> são das funcionalidades mais antigas do WordPress que ainda funcionam como um relógio. Com a ação <code>do_feed</code> (e outras ações relevantes), você pode controlar os <em>feeds</em>.</p>

<h3>Removendo Todos Os <em>Feeds</em> do WordPress</h3>

<p>Remover os <em>links</em> dos <em>feeds</em> torna-os inacessíveis para quase todo mundo, a não ser que o visitante saiba que você usa o WordPress e tenha conhecimento sobre <em>feeds</em> e tentem adicionar <code>/feed/</code> logo após a URL do seu site para ter acesso aos <em>feeds</em>. E se você precisar desabilitar todos de uma só vez? O trecho abaixo desabilitará todos de uma só vez para você:</p>

<pre class="brush: php">&lt;?php

add_action( 'do_feed',  'do_feed_example', 1 );
add_action( 'do_feed_atom', 'do_feed_example', 1 );
add_action( 'do_feed_rdf',  'do_feed_example', 1 );
add_action( 'do_feed_rss2', 'do_feed_example', 1 );
add_action( 'do_feed_rss',  'do_feed_example', 1 );

function do_feed_example() {
    wp_die( __( '&lt;h1&gt;Feed não disponível, por favor, visite nossa &lt;a href="' . get_bloginfo( 'url' ) . '"&gt;Página Inicial&lt;/a&gt;!&lt;/h1&gt;' ) );
}

// Código Fonte de Exemplo: http://wpdevsnippets.com/disable-rss-feed/

?&gt;</pre>

<p>Fácil, não é?</p>

<h2>Modificando a Barra de Ferramentas</h2>

<p>A Barra de Ferramentas (antes, Barra Administrativa) foi apresentada na versão 3.1 do WordPress e tornou-se alvo de amor e discórdia – alguns querem removê-la completamente, outros não vivem sem. De qualquer forma, a ação <code>admin_bar_menu</code> é o gancho principal para a Barra de Ferramentas e que carrega os itens necessários nela.</p>

<h3>Sempre Mostrar a Barra de Ferramentas Para Todo Mundo</h3>

<p>A barra de ferramentas pode ser bem útil se ela não destoar muito do <em>design</em> do seu site – você pode usar o campo de busca embutido e adicionar novos itens de menu, como <em>links</em> para acesso ao painel administrativo ou um <em>link</em> para a página de contato.</p>

<p>O trecho abaixo faz com que a barra de ferramentas sempre esteja visível, tenha o visitante feito <em>login</em> ou não:</p>

<pre class="brush: php">&lt;?php

'add_action( 'admin_bar_menu', 'admin_bar_menu_example' );
add_filter( 'show_admin_bar', '__return_true' , 1000 );

function admin_bar_menu_example( $wp_admin_bar ) {

	if ( ! is_user_logged_in() ) {

		$wp_admin_bar-&gt;add_menu( array( 'title' =&gt; __( 'Painel Administrativo' ), 'href' =&gt; wp_login_url() ) );
		$wp_admin_bar-&gt;add_menu( array( 'title' =&gt; __( 'Contato' ), 'href' =&gt; 'http://www.seusite.com/contato/' ) );

	}

}

// Código Fonte de Exemplo: http://blog.ftwr.co.uk/archives/2011/01/05/always-show-admin-bar/

?&gt;</pre>

<p>Vê como é bem fácil? Agora, seu visitantes podem ver os <em>links</em> para o "Painel Administrativo" e de "Contato" juntos do campo de busca.</p>

<h2>Controlando o <em>Widget</em> Padrão das "Categorias"</h2>

<p>Você pode mostrar uma lista de categorias com a função <code>wp_list_categories()</code>. E a ação (homônima à função) ajuda-nos a customizar o retorno dela.</p>

<h3>Removendo o Atributo <code>title</code> dos <em>Links</em> das Categorias</h3>

<p>Se achar que não precisa dos atributos <code>title</code> dos <em>links</em> das categorias no <em>widget</em> de categorias, você pode removê-los usando essas poucas linhas de código em seu projeto:</p>

<pre class="brush: php">&lt;?php

add_action( 'wp_list_categories', 'wp_list_categories_example' );

function wp_list_categories_example() {
return preg_replace( '` title="(.+)"`', '', $output );
}

// Código Fonte de Exemplo: http://wpsnipp.com/index.php/cat/remove-title-attribute-from-wp_list_categories/

?&gt;</pre>

<h2>Manipulando o Formulário de Busca Antes do Processamento</h2>

<p>Para usar a funcionalidade busca integrada, você precisa usar a função <code>get_search_form()</code>. Se quiser manipular essa função <em>antes</em> do resultado ser apresentado, a ação <code>pre_get_search_form()</code> é a que você precisa usar.</p>

<h3>Adicionando Textos Informativo Antes do Formulário de Busca</h3>

<p>Digamos que você tem um blog onde você resenha centenhas, talvez milhares de produtos comerciais. Para informar a seus visitantes que eles podem digitar o código de barras dos produtos que precisam, use o trecho de código abaixo para adicionar um texto informativo antes do campo de busca.</p>

<pre class="brush: php">&lt;?php

add_action( 'pre_get_search_form', 'pre_get_search_form_example' );
function pre_get_search_form_example( $form ) {
	echo '&lt;div class="search-info"&gt;Você pode digitar o código de barras do produto que estiver procurando.&lt;/div&gt;';
}

?&gt;</pre>

<p>Note que você pode usar esse exemplo com a ação <code>template_redirect</code> para quando os usuários digitarem um código de barras, eles seja direcionados para a página da resenha do produto, automaticamente.</p>

<h2>Fim da Parte Quatro</h2>

<p>Passamos pelo quarto conjunto das 50 ações neste artigo. Espero que tenha gostado e aprendido novas coisas. Brinque um pouco com o que você aprendeu. Vejo você no próximo artigo!</p>

<p>Gostaria de saber o que vocês têm achado desta série. Tem gostado das ações selecionadas? Deixe seus comentários, logo abaixo. E, caso tenha curtido o artigo, não esqueça de compartilhá-lo!</p>