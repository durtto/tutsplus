<h1>Adicionando Funções à sua <em>Framework</em> para Temas de WordPress</h1>

<p>No último post dessa série, você <a href="https://.tutsplus.com/tutorials/adding-action-hooks-to-your-wordpress-theme-framework--cms-21664" target="_self">adicionou alguns ganchos de ação</a> à sua <em>framework</em> para temas. Nesse tutorial, você criará algumas funções para ativar esses ganchos.</p>

<p>Se você tem usado o código de exemplo, terá seis ganchos em sua <em>framework</em>:</p>

<ul><li><code class="inline">wptp_in_header</code>, aquela que fica no topo, no lado direito do cabeçalho</li>
<li><code class="inline">wptp_before_content</code>, que vem logo antes do <em>loop</em></li>
<li><code class="inline">wptp_after_content</code>, que vem logo depois do <em>loop</em></li>
<li><code class="inline">wptp_sidebar</code>, que fica no arquivo <code>sidebar.php</code></li>
<li><code class="inline">wptp_footer</code>, que fica dentro do elemento <code>footer</code></li>
<li><code class="inline">wptp_after_footer</code>, que fica após o elemento <code>footer</code>.</li>
</ul>

<p>Nesse tutorial, mostrarei como adicionar áreas de <em>widget</em> a três desses ganchos e uma função customizada ao último.</p>

<h2>O Que Você Precisará</h2>

<p>Para acompanhar esse tutorial, você precisará de:</p>

<ul><li>Um ambiente para desenvolvimento com o WordPress;</li>
<li>Seu próprio tema ou os arquivos do tema criados na <a href="https://code.tutsplus.com/tutorials/creating-the-starting-files-for-your-wordpress-theme-framework--cms-21662" target="_self">Parte 3</a> dessa série, os quais você pode encontrar no repositório do GitHub que acompanha a série;</li>
<li>Um editor de código</li>
</ul>

<h2>Adicionando Áreas de <em>Widget</em> Através de Funções</h2>

<p>O primeiro passo é adicionar a função para as áreas de <em>widget</em>. Você talvez lembre que elas foram codificadas, originalmente, nos arquivos relevantes do modelo. Contudo, adicioná-las através de funções permite que os usuários de sua <em>framework</em> possam sobrescrever a função em um momento futuro, seja removendo as áreas de <em>widget</em> ou substituindo por outra coisa.</p>

<h3>Criando um Arquivo de Inclusão para a Área de Widget</h3>

<p>Já que as áreas de <em>widget</em> são adicionadas através de funções, você não as codificará nos arquivos relevantes do modelo. Você poderia adicioná-las a seu arquivo <code class="inline">functions.php</code>, porém, para manter o código administrável/manutenível, criaremos um arquivo de inclusão com o código para as áreas de <em>widget</em>.</p>

<p>Crie um diretório chamado <code class="inline">includes</code> dentro da pasta do seu tema e, dentro dele, crie um arquivo <code class="inline">widgets.php</code>. Salve esse arquivo.</p>

<p>Agora, abra seu arquivo <code class="inline">functions.php</code> e adicione o trecho a seguir antes de suas outras funções:</p>

<pre class="brush: php">// inclusão dos widgets
include( TEMPLATEPATH . '/includes/widgets.php' );</pre>

<p>Esse trecho traz o conteúdo do arquivo <code class="inline">widgets.php</code> para essa posição do arquivo de funções.</p>

<p>Agore, salve seu arquivo de funções.</p>

<h3>A Área de <em>Widget</em> no Cabeçalho</h3>

<p>Primeiro, adicionaremos a área de <em>widget</em> no cabeçalho. Abra seu arquivo <code class="inline">widgets.php</code> e adicione isso:</p>

<pre class="brush: php">function wptp_in_header_widget_area() {
    if ( is_active_sidebar( 'in-header-widget-area' ) ) { ?&gt;
		&lt;aside class="in-header widget-area" role="complementary"&gt;
			&lt;?php dynamic_sidebar( 'in-header-widget-area' ); ?&gt;
		&lt;/aside&gt;
	&lt;?php }
}
add_action( 'wptp_in_header', 'wptp_in_header_widget_area' );</pre>

<p>A função <code class="inline">wptp_in_header_widget_area()</code> adiciona o código para a área de <em>widget</em> no lugar correto. Primeiro, ele verifica se a área de <em>widget</em> está populada com <em>widgets</em>, usando <code class="inline">if( is_active_sidebar)</code>, e então, se estiver preenchido, ele retorna o <em>widget</em> num elemento <code class="inline">aside</code>.</p>

<p>A função é ativada através do gancho de ação <code class="inline">wptp_in_header</code>, que adicionamos ao arquivo <code class="inline">header.php</code> no tutorial passado. Ele substitui o código da área de <em>widget</em> que, antes, estava localizado no arquivo <code class="inline">header.php</code> em si.</p>

<p>Fazendo assim, permitimos que você remova a área de <em>widget</em> em um site que use um tema filho do seu tema, bastando usar a função <code class="inline">remove_action()</code>, dessa forma:</p>

<pre class="brush: php">remove_action( 'wptp_in_header', 'wptp_in_header_widget_area' );</pre>

<p>Isso também significa que você pode adicionar funcionalidades extras que podem ser ativadas através do mesmo gancho, então, se quisesse adicionar um botão de ação acima da área de <em>widget</em>, por exemplo, você criaria uma função contendo o código respectivo e a anexaria ao gancho de ação <code class="inline">wptp_in_header</code>, com uma prioridade menor que 10, uma vez que essa é a prioridade padrão que será dada à função da área de <em>widget</em> acima. Funções com uma prioridade menor são chamadas primeiro.</p>

<pre class="brush: php">function wptp_add_cta() {
    //código para o botão de ação
}
add_action( 'wptp_in_header' , 'wttp_add_cta', 5 );</pre>

<p><i>Você pode aprender mais sobre a função <code class="inline">add_action()</code> no </i><a href="http://codex.wordpress.org/Function_Reference/add_action" target="_self"><i>WordPress Codex</i></a><i>.</i></p>

<h3>Uma Área de <em>Widget</em> na <em>Lateral</em></h3>

<p>O próximo passo é adicionar a área de <em>widget</em> na <em>lateral</em>, usando um trecho de código parecido com o que você já usou em seu arquivo <code class="inline">widgets.php</code>:</p>

<pre class="brush: php">function wptp_sidebar_widget_area() {
    if ( is_active_sidebar( 'sidebar-widget-area' ) ) { ?&gt;
		&lt;aside class="sidebar widget-area" role="complementary"&gt;
			&lt;?php dynamic_sidebar( 'sidebar-widget-area' ); ?&gt;
		&lt;/aside&gt;
	&lt;?php }
}
add_action( 'wptp_sidebar', 'wptp_sidebar_widget_area' );</pre>

<p>Esse trecho adiciona uma área de <em>widgets</em> à <em>lateral</em>, desde que ela esteja populada, usando as classes relevantes para que possa ser estilizada.</p>

<h3>A Área de <em>Widgets</em> do Rodapé</h3>

<p>Finalmente, adicionaremos <em>widgets</em> no rodapé. Adicionarei quatro áreas de <em>widgets</em> lá - você pode adicionar menos <em>widgets</em>, se quiser. Minha área de <em>widget</em> usa classes que lançam mão de CSS Orientado a Objetos usado no meu tema.</p>

<p>Novamente, no arquivo <code class="inline">widgets.php</code>, adicione o trecho a seguir:</p>

<pre class="brush: php">function wptp_footer_widget_area() { ?&gt;

    &lt;aside class="fatfooter" role="complementary"&gt;

		&lt;?php
		// a primeira área de widgets
		if ( is_active_sidebar( 'first-footer-widget-area' ) ) { ?&gt;
			&lt;aside class="first quarter left widget-area"&gt;
				&lt;?php dynamic_sidebar( 'first-footer-widget-area' ); ?&gt;
			&lt;/aside&gt;&lt;!-- .first .widget-area --&gt;
		&lt;?php }

		// a segunda área de widgets
		if ( is_active_sidebar( 'second-footer-widget-area' ) ) { ?&gt;
			&lt;aside class="second quarter widget-area"&gt;
				&lt;?php dynamic_sidebar( 'second-footer-widget-area' ); ?&gt;
			&lt;/aside&gt;&lt;!-- .first .widget-area --&gt;
		&lt;?php }

		// a terceira área de widgets
		if ( is_active_sidebar( 'third-footer-widget-area' ) ) { ?&gt;
			&lt;aside class="third quarter widget-area"&gt;
				&lt;?php dynamic_sidebar( 'third-footer-widget-area' ); ?&gt;
			&lt;/aside&gt;&lt;!-- .first .widget-area --&gt;
		&lt;?php }

		// a quarta área de widgets
		if ( is_active_sidebar( 'fourth-footer-widget-area' ) ) { ?&gt;
			&lt;aside class="fourth right quarter widget-area"&gt;
				&lt;?php dynamic_sidebar( 'fourth-footer-widget-area' ); ?&gt;
			&lt;/aside&gt;&lt;!-- .first .widget-area --&gt;
		&lt;?php } ?&gt;

	&lt;/aside&gt;

&lt;?php
}
add_action( 'wptp_footer', 'wptp_footer_widget_area' );</pre>

<p>Isso adicionará quatro áreas de <em>widgets</em> dentro de um elemento <code class="inline">aside</code> com a classe <code class="inline">fatfooter</code> - em meu tema, isso é usado para estilização, signficando que um plano de fundo integral pode ser aplicado ao elemento <code class="inline">footer</code>, enquanto o elemento <code class="inline">aside.fatfooter</code> pode ser centralizado na tela.</p>

<p>Tendo adicionado <em>widgets</em> à minha área de <em>widgets</em>, você pode ver como ela está agora:</p>

<figure class="post_image"><img alt="" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/227/posts/21717/image/add-functions-to-your-wordpress-theme-framework-populated-widgets.jpg"></figure>

<h2>Adicionando uma função ao Cólofon</h2>

<p>Assim como áreas de <em>widgets</em>, adicionarei uma função ao meu tema que insere um texto no cólofon. Ele será ativado através do gancho <code class="inline">wptp_after_footer</code>, assim, ele ficará bem no final da tela.</p>

<p>Como isso não é um <em>widget</em>, adicionarei o código no meu arquivo <code class="inline">functions.php</code>:</p>

<pre class="brush: php">function wptp_colophon() { ?&gt;
    &lt;section class="colophon" role="contentinfo"&gt;
		&lt;small class="copyright half left"&gt;
			&amp;copy; &lt;a href="&lt;?php echo home_url( '/' ) ?&gt;"&gt;&lt;?php bloginfo( 'name' ); ?&gt;&lt;/a&gt; 2014
		&lt;/small&gt;&lt;!-- #copyright --&gt;

		&lt;small class="credits half right"&gt;
				&lt;?php _e( 'Orgulhosamente desenvolvido por', 'tutsplus' ); ?&gt; &lt;a href="http://wordpress.org/"&gt;WordPress&lt;/a&gt;.
			&lt;/a&gt;
		&lt;/small&gt;&lt;!-- #credits --&gt;
	&lt;/section&gt;&lt;!--#colophon--&gt;

&lt;?php
}</pre>

<p>Isso adiciona um elemento <code>section</code> com o código para o cólofon. Agora, você pode ver o cólofon em meu site:</p>

<figure class="post_image"><img alt="" src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/227/posts/21717/image/add-functions-to-your-wordpress-theme-framework-colophon.jpg"></figure>

<p>Como pode ver, o texto padrão para o <em>link</em> dos direitos de autorais (<em>copyright</em>) é o título do site. Se eu quiser sobrescreve-lo em um tema filho, posso fazê-lo, facilmente, criando uma nova função atrelada ao gancho de ação <code class="inline">wptp_after_footer</code> e removendo a ação original usando <code class="inline"><a href="http://codex.wordpress.org/Function_Reference/remove_action" target="_self">remove_action()</a></code>:</p>

<pre class="brush: php">remove_action( 'wptp_after_footer', 'wptp_colophon' );</pre>

<p>Alternativamente, poderia tornar minha função original em uma função <a href="http://codex.wordpress.org/Pluggable_Functions" target="_self">plugável</a>, que significa que ela não fica ativada quando outra função com o mesmo nome já foi encontrada pelo WordPress (em um tema filho, por exemplo). Eu faria isso envolvendo a função em um código condicional, dessa forma:</p>

<pre class="brush: php">if ( ! function_exists( 'wptp_colophon' ) ) {
    function wptp_colophon() { ?&gt;
		&lt;section class="colophon" role="contentinfo"&gt;
			&lt;small class="copyright half left"&gt;
				&amp;copy; &lt;a href="&lt;?php echo home_url( '/' ) ?&gt;"&gt;&lt;?php bloginfo( 'name' ); ?&gt;&lt;/a&gt; 2014
			&lt;/small&gt;&lt;!-- #copyright --&gt;

			&lt;small class="credits half right"&gt;
					&lt;?php _e( 'Proudly powered by', 'tutsplus' ); ?&gt; &lt;a href="http://wordpress.org/"&gt;WordPress&lt;/a&gt;.
				&lt;/a&gt;
			&lt;/small&gt;&lt;!-- #credits --&gt;
		&lt;/section&gt;&lt;!--#colophon--&gt;

	&lt;?php
	}

}
add_action( 'wptp_after_footer', 'wptp_colophon' );</pre>

<p>Se eu adicionar uma função <code class="inline">wptp_colophon</code> ao meu tema, o WordPress a executará ao invés da do tema pai. Bem legal, hein?</p>

<p><i>Note que, nesse caso, uma solução melhor para lidar com o texto de direitos autorais seria envolver o cógigo em um gancho de filtro. Cobriremos mais sobre ele em uma parte futura dessa série.</i></p>

<h2>Conclusão</h2>

<p>Sua <em>Framework</em> para Temas de WordPress, agora, tem algumas funções. Nesse tutorial, mostramos como usar ganchos de ação que você criou em artigos anteriores para ativar funções adicionadas ao arquivo <code class="inline">functions.php</code> ou em um arquivo de inclusão criado para seu tema.</p>

<p>No primeiro artigo dessa série, mencionei que uma <em>framework</em> para temas madura é muito mais que um tema pai: é um ecosistema. Isso significa que você usará muitos ganchos de ação em seu tema para ativar funções em <em>plugins</em> escritos, especificamente, para sites usando a <em>framework</em>, ou em um tema filho dela.</p>

<p>Várias das mais populares <em>frameworks</em> para temas de WordPress fazem isso e não há razão para não fazê-lo também. Por exemplo, talvez você crie um <em>plugin</em> para adicionar laterais adicionais a um site e, então, ativá-las através de um gancho chamado <code class="inline">wptp_sidebar</code>. </p>

<p>Isso poderia ser muito útil se o <em>plugin</em> for usado em mais de um site, de forma que você pode replicar tal funcionalidades em temas filhos relevantes. Já fiz isso várias vezes, quando o site precisou de laterais para listar páginas na mesma parte da hierarquia de uma página - é um código genérico bastante útil em mais de um site.</p>

<p>Na próxima parte dessa série, você aprenderá como adicionar ganchos de filtro à sua <em>framework</em>.</p>

